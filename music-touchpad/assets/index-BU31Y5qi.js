(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const jt="modulepreload",Rt=function(e){return"/music-touchpad/"+e},ze={},fe=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){let a=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");o=a(n.map(c=>{if(c=Rt(c),c in ze)return;ze[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":jt,d||(p.as="script"),p.crossOrigin="",p.href=c,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((h,g)=>{p.addEventListener("load",h),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return o.then(s=>{for(const l of s||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})};function qt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Gt(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),n}var Ce={exports:{}},Ee={exports:{}},Se,Ke;function Ht(){if(Ke)return Se;Ke=1;function e(n){return n>64&&n<91?n-65:n>96&&n<123?n-71:n>47&&n<58?n+4:n===43?62:n===47?63:0}function t(n,r){for(var o=n.replace(/[^A-Za-z0-9\+\/]/g,""),i=o.length,s=r?Math.ceil((i*3+1>>2)/r)*r:i*3+1>>2,l=new Uint8Array(s),a,c,d=0,u=0,p=0;p<i;p++)if(c=p&3,d|=e(o.charCodeAt(p))<<18-6*c,c===3||i-p===1){for(a=0;a<3&&u<s;a++,u++)l[u]=d>>>(16>>>a&24)&255;d=0}return l}return Se={decode:t},Se}var _e,Je;function Yt(){return Je||(Je=1,_e=function(e,t){return new Promise(function(n,r){var o=new XMLHttpRequest;t&&(o.responseType=t),o.open("GET",e),o.onload=function(){o.status===200?n(o.response):r(Error(o.statusText))},o.onerror=function(){r(Error("Network Error"))},o.send()})}),_e}var Ze;function Ut(){return Ze||(Ze=1,(function(e){var t=Ht(),n=Yt();function r(b){return function(w){return typeof w=="string"&&b.test(w)}}function o(b,w){return typeof b=="string"?b+w:typeof b=="function"?b(w):w}function i(b,w,I,N){var F=s(w)?l:a(w)?c:d(w)?u:p(w)?h:g(w)?f:m(w)?v:y(w)?C:A(w)?T:null,Y=I||{};return F?F(b,w,Y):N?Promise.resolve(N):Promise.reject("Source not valid ("+w+")")}i.fetch=n;function s(b){return b instanceof ArrayBuffer}function l(b,w,I){return new Promise(function(N,F){b.decodeAudioData(w,function(Y){N(Y)},function(){F("Can't decode audio data ("+w.slice(0,30)+"...)")})})}var a=r(/\.(mp3|wav|ogg)(\?.*)?$/i);function c(b,w,I){var N=o(I.from,w);return i(b,i.fetch(N,"arraybuffer"),I)}function d(b){return b&&typeof b.then=="function"}function u(b,w,I){return w.then(function(N){return i(b,N,I)})}var p=Array.isArray;function h(b,w,I){return Promise.all(w.map(function(N){return i(b,N,I,N)}))}function g(b){return b&&typeof b=="object"}function f(b,w,I){var N={},F=Object.keys(w).map(function(Y){if(I.only&&I.only.indexOf(Y)===-1)return null;var Z=w[Y];return i(b,Z,I,Z).then(function(S){N[Y]=S})});return Promise.all(F).then(function(){return N})}var m=r(/\.json(\?.*)?$/i);function v(b,w,I){var N=o(I.from,w);return i(b,i.fetch(N,"text").then(JSON.parse),I)}var y=r(/^data:audio/);function C(b,w,I){var N=w.indexOf(",");return i(b,t.decode(w.slice(N+1)).buffer,I)}var A=r(/\.js(\?.*)?$/i);function T(b,w,I){var N=o(I.from,w);return i(b,i.fetch(N,"text").then(L),I)}function L(b){var w=b.indexOf("MIDI.Soundfont.");if(w<0)throw Error("Invalid MIDI.js Soundfont format");w=b.indexOf("=",w)+2;var I=b.lastIndexOf(",");return JSON.parse(b.slice(w,I)+"}")}e.exports&&(e.exports=i),typeof window<"u"&&(window.loadAudio=i)})(Ee)),Ee.exports}var Le={exports:{}},Ne,Qe;function Vt(){if(Qe)return Ne;Qe=1,Ne=e;function e(l){var a=l.createGain(),c=a._voltage=r(l),d=o(c),u=o(c),p=o(c);return a._startAmount=o(u),a._endAmount=o(p),a._multiplier=o(d),a._multiplier.connect(a),a._startAmount.connect(a),a._endAmount.connect(a),a.value=d.gain,a.startValue=u.gain,a.endValue=p.gain,a.startValue.value=0,a.endValue.value=0,Object.defineProperties(a,t),a}var t={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(l){var a=this._multiplier.gain,c=this._startAmount.gain,d=this._endAmount.gain;this._voltage.start(l),this._decayFrom=this._decayFrom=l+this.attack,this._startedAt=l;var u=this.sustain;a.cancelScheduledValues(l),c.cancelScheduledValues(l),d.cancelScheduledValues(l),d.setValueAtTime(0,l),this.attack?(a.setValueAtTime(0,l),a.linearRampToValueAtTime(1,l+this.attack),c.setValueAtTime(1,l),c.linearRampToValueAtTime(0,l+this.attack)):(a.setValueAtTime(1,l),c.setValueAtTime(0,l)),this.decay&&a.setTargetAtTime(u,this._decayFrom,i(this.decay))}},stop:{value:function(l,a){a&&(l=l-this.release);var c=l+this.release;if(this.release){var d=this._multiplier.gain,u=this._startAmount.gain,p=this._endAmount.gain;d.cancelScheduledValues(l),u.cancelScheduledValues(l),p.cancelScheduledValues(l);var h=i(this.release);if(this.attack&&l<this._decayFrom){var g=s(0,1,this._startedAt,this._decayFrom,l);d.linearRampToValueAtTime(g,l),u.linearRampToValueAtTime(1-g,l),u.setTargetAtTime(0,l,h)}p.setTargetAtTime(1,l,h),d.setTargetAtTime(0,l,h)}return this._voltage.stop(c),c}},onended:{get:function(){return this._voltage.onended},set:function(l){this._voltage.onended=l}}},n=new Float32Array([1,1]);function r(l){var a=l.createBufferSource(),c=l.createBuffer(1,2,l.sampleRate);return c.getChannelData(0).set(n),a.buffer=c,a.loop=!0,a}function o(l){var a=l.context.createGain();return l.connect(a),a}function i(l){return Math.log(l+1)/Math.log(100)}function s(l,a,c,d,u){var p=a-l,h=d-c,g=u-c,f=g/h,m=l+f*p;return m<=l&&(m=l),m>=a&&(m=a),m}return Ne}var Ie,et;function Xt(){if(et)return Ie;et=1;var e=Vt(),t={},n={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function r(a,c,d){var u=!1,p=0,h={},g=a.createGain();g.gain.value=1;var f=Object.assign({},n,d),m={context:a,out:g,opts:f};return c instanceof AudioBuffer?m.buffer=c:m.buffers=c,m.start=function(C,A,T){if(m.buffer&&C!==null)return m.start(null,C,A);var L=C?m.buffers[C]:m.buffer;if(L){if(!u){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+C+" not found.");return}var b=T||t;A=Math.max(a.currentTime,A||0),m.emit("start",A,C,b);var w=y(C,L,b);return w.id=v(C,w),w.env.start(A),w.source.start(A),m.emit("started",A,w.id,w),b.duration&&w.stop(A+b.duration),w},m.play=function(C,A,T){return m.start(C,A,T)},m.stop=function(C,A){var T;return A=A||Object.keys(h),A.map(function(L){return T=h[L],T?(T.stop(C),T.id):null})},m.connect=function(C){return u=!0,g.connect(C),m},m.emit=function(C,A,T,L){m.onevent&&m.onevent(C,A,T,L);var b=m["on"+C];b&&b(A,T,L)},m;function v(C,A){return A.id=p++,h[A.id]=A,A.source.onended=function(){var T=a.currentTime;A.source.disconnect(),A.env.disconnect(),A.disconnect(),m.emit("ended",T,A.id,A)},A.id}function y(C,A,T){var L=a.createGain();return L.gain.value=0,L.connect(g),L.env=s(a,T,f),L.env.connect(L.gain),L.source=a.createBufferSource(),L.source.buffer=A,L.source.connect(L),L.source.loop=T.loop||f.loop,L.source.playbackRate.value=l(T.cents||f.cents),L.source.loopStart=T.loopStart||f.loopStart,L.source.loopEnd=T.loopEnd||f.loopEnd,L.stop=function(b){var w=b||a.currentTime;m.emit("stop",w,C);var I=L.env.stop(w);L.source.stop(I)},L}}function o(a){return typeof a=="number"}var i=["attack","decay","sustain","release"];function s(a,c,d){var u=e(a),p=c.adsr||d.adsr;return i.forEach(function(h,g){p?u[h]=p[g]:u[h]=c[h]||d[h]}),u.value.value=o(c.gain)?c.gain:o(d.gain)?d.gain:1,u}function l(a){return a?Math.pow(2,a/1200):1}return Ie=r,Ie}var Me,tt;function Wt(){if(tt)return Me;tt=1,Me=function(t){return t.on=function(n,r){if(arguments.length===1&&typeof n=="function")return t.on("event",n);var o="on"+n,i=t[o];return t[o]=i?e(i,r):r,t},t};function e(t,n){return function(r,o,i,s){t(r,o,i,s),n(r,o,i,s)}}return Me}var Te,nt;function zt(){if(nt)return Te;nt=1;var e=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function t(){return e}var n=[0,2,4,5,7,9,11];function r(l,a,c){if(typeof l!="string")return null;var d=e.exec(l);if(!d||!a&&d[4])return null;var u={letter:d[1].toUpperCase(),acc:d[2].replace(/x/g,"##")};return u.pc=u.letter+u.acc,u.step=(u.letter.charCodeAt(0)+3)%7,u.alt=u.acc[0]==="b"?-u.acc.length:u.acc.length,u.chroma=n[u.step]+u.alt,d[3]&&(u.oct=+d[3],u.midi=u.chroma+12*(u.oct+1),u.freq=o(u.midi,c)),a&&(u.tonicOf=d[4]),u}function o(l,a){return Math.pow(2,(l-69)/12)*(a||440)}var i={parse:r,regex:t,midiToFreq:o},s=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];return s.forEach(function(l){i[l]=function(a){var c=r(a);return c&&typeof c[l]<"u"?c[l]:null}}),Te=i,Te}var Pe,ot;function Kt(){if(ot)return Pe;ot=1;var e=zt(),t=function(o){return o!==null&&o!==[]&&o>=0&&o<129},n=function(o){return t(o)?+o:e.midi(o)};Pe=function(o){if(o.buffers){var i=o.opts.map,s=typeof i=="function"?i:n,l=function(c){return c?s(c)||c:null};o.buffers=r(o.buffers,l);var a=o.start;o.start=function(c,d,u){var p=l(c),h=p%1;return h&&(p=Math.floor(p),u=Object.assign(u||{},{cents:Math.floor(h*100)})),a(p,d,u)}}return o};function r(o,i){return Object.keys(o).reduce(function(s,l){return s[i(l)]=o[l],s},{})}return Pe}var ke,rt;function Jt(){if(rt)return ke;rt=1;var e=Array.isArray,t=function(r){return r&&typeof r=="object"},n={};return ke=function(r){return r.schedule=function(o,i){var s=r.context.currentTime,l=o<s?s:o;r.emit("schedule",l,i);var a,c,d,u;return i.map(function(p){if(p)e(p)?(a=p[0],c=p[1]):(a=p.time,c=p);else return null;return t(c)?(d=c.name||c.key||c.note||c.midi||null,u=c):(d=c,u=n),r.start(d,l+(a||0),u)})},r},ke}function he(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Oe={exports:{}},it;function Zt(){return it||(it=1,(function(e,t){(function(n){e.exports=n()})(function(){return(function n(r,o,i){function s(c,d){if(!o[c]){if(!r[c]){var u=typeof he=="function"&&he;if(!d&&u)return u(c,!0);if(l)return l(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var h=o[c]={exports:{}};r[c][0].call(h.exports,function(g){var f=r[c][1][g];return s(f||g)},h,h.exports,n,r,o,i)}return o[c].exports}for(var l=typeof he=="function"&&he,a=0;a<i.length;a++)s(i[a]);return s})({1:[function(n,r,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(i){function s(l){if(this._event=l,this._data=l.data,this.receivedTime=l.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=l.data[0]&240,this.channel=l.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=l.data[1]&127,this.velocity=l.data[2]&127;break;case 144:this.messageType="noteon",this.key=l.data[1]&127,this.velocity=l.data[2]&127;break;case 160:this.messageType="keypressure",this.key=l.data[1]&127,this.pressure=l.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=l.data[1]&127,this.controllerValue=l.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=l.data[1];break;case 208:this.messageType="channelpressure",this.pressure=l.data[1]&127;break;case 224:this.messageType="pitchbendchange";var a=l.data[2]&127,c=l.data[1]&127;this.pitchBend=(a<<8)+c;break}}return new s(i)},r.exports=o.default},{}]},{},[1])(1)})})(Oe)),Oe.exports}var Be,st;function Qt(){if(st)return Be;st=1;var e=Zt();return Be=function(t){return t.listenToMidi=function(n,r){var o={},i=r||{},s=i.gain||function(l){return l/127};return n.onmidimessage=function(l){var a=l.messageType?l:e(l);if(a.messageType==="noteon"&&a.velocity===0&&(a.messageType="noteoff"),!(i.channel&&a.channel!==i.channel))switch(a.messageType){case"noteon":o[a.key]=t.play(a.key,0,{gain:s(a.velocity)});break;case"noteoff":o[a.key]&&(o[a.key].stop(),delete o[a.key]);break}},t},t},Be}var lt;function en(){return lt||(lt=1,(function(e){var t=Xt(),n=Wt(),r=Kt(),o=Jt(),i=Qt();function s(l,a,c){return i(o(r(n(t(l,a,c)))))}e.exports&&(e.exports=s),typeof window<"u"&&(window.SamplePlayer=s)})(Le)),Le.exports}function at(e,t){return Array(t+1).join(e)}function Ge(e){return typeof e=="number"}function tn(e){return typeof e=="string"}function nn(e){return typeof e<"u"}function bt(e,t){return Math.pow(2,(e-69)/12)*(t||440)}var At=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function on(){return At}var rn=[0,2,4,5,7,9,11];function J(e,t,n){if(typeof e!="string")return null;var r=At.exec(e);if(!r||!t&&r[4])return null;var o={letter:r[1].toUpperCase(),acc:r[2].replace(/x/g,"##")};o.pc=o.letter+o.acc,o.step=(o.letter.charCodeAt(0)+3)%7,o.alt=o.acc[0]==="b"?-o.acc.length:o.acc.length;var i=rn[o.step]+o.alt;return o.chroma=i<0?12+i:i%12,r[3]&&(o.oct=+r[3],o.midi=i+12*(o.oct+1),o.freq=bt(o.midi,n)),t&&(o.tonicOf=r[4]),o}var sn="CDEFGAB";function ln(e){return Ge(e)?e<0?at("b",-e):at("#",e):""}function an(e){return Ge(e)?""+e:""}function Ct(e,t,n){return e===null||typeof e>"u"?null:e.step?Ct(e.step,e.alt,e.oct):e<0||e>6?null:sn.charAt(e)+ln(t)+an(n)}function Et(e){if((Ge(e)||tn(e))&&e>=0&&e<128)return+e;var t=J(e);return t&&nn(t.midi)?t.midi:null}function cn(e,t){var n=Et(e);return n===null?null:bt(n,t)}function un(e){return(J(e)||{}).letter}function dn(e){return(J(e)||{}).acc}function fn(e){return(J(e)||{}).pc}function hn(e){return(J(e)||{}).step}function pn(e){return(J(e)||{}).alt}function gn(e){return(J(e)||{}).chroma}function mn(e){return(J(e)||{}).oct}const vn=Object.freeze(Object.defineProperty({__proto__:null,acc:dn,alt:pn,build:Ct,chroma:gn,freq:cn,letter:un,midi:Et,oct:mn,parse:J,pc:fn,regex:on,step:hn},Symbol.toStringTag,{value:"Module"})),wn=Gt(vn);var De,ct;function yn(){if(ct)return De;ct=1;var e=wn;function t(o,i){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof t))return new t(o);this.nameToUrl=i||t.nameToUrl,this.ctx=o,this.instruments={},this.promises=[]}t.prototype.onready=function(o){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(o)},t.prototype.instrument=function(o,i){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var s=this.ctx;if(o=o||"default",o in this.instruments)return this.instruments[o];var l={name:o,play:r(s,i)};if(this.instruments[o]=l,o!=="default"){var a=t.instrument(s,o,i).then(function(c){return l.play=c.play,l});this.promises.push(a),l.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),a.then(c)}}else l.onready=function(c){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c()};return l};function n(o,i,s){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),t.instrument(o,i,s).then(function(l){return l.buffers})}t.loadBuffers=n;function r(o,i){return i=i||{},function(s,l,a,c){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var d=s>0&&s<129?+s:e.midi(s),u=d?e.midiToFreq(d,440):null;if(u){a=a||.2,c=c||{};var p=c.destination||i.destination||o.destination,h=c.vcoType||i.vcoType||"sine",g=c.gain||i.gain||.4,f=o.createOscillator();f.type=h,f.frequency.value=u;var m=o.createGain();return m.gain.value=g,f.connect(m),m.connect(p),f.start(l),a>0&&f.stop(l+a),f}}}return t.noteToMidi=e.midi,De=t,De}var ut;function xn(){return ut||(ut=1,(function(e){var t=Ut(),n=en();function r(l,a,c){if(arguments.length===1)return function(g,f){return r(l,g,f)};var d=c||{},u=d.isSoundfontURL||o,p=d.nameToUrl||i,h=u(a)?a:p(a,d.soundfont,d.format);return t(l,h,{only:d.only||d.notes}).then(function(g){var f=n(l,g,d).connect(d.destination?d.destination:l.destination);return f.url=h,f.name=a,f})}function o(l){return/\.js(\?.*)?$/i.test(l)}function i(l,a,c){return c=c==="ogg"?c:"mp3",a=a==="FluidR3_GM"?a:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+a+"/"+l+"-"+c+".js"}var s=yn();s.instrument=r,s.nameToUrl=i,e.exports&&(e.exports=s),typeof window<"u"&&(window.Soundfont=s)})(Ce)),Ce.exports}var bn=xn();const dt=qt(bn),An=new Set(["drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synthstrings_1","synthstrings_2","choir_aahs","voice_oohs","synth_voice","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep"]);class Cn{instrument=null;activeNotes=new Map;ready=!1;audioContext=null;currentInstrumentName="";async initialize(t="electric_piano_1"){try{this.audioContext=new AudioContext;const n=this.getInstrumentLoadOptions(t);this.instrument=await dt.instrument(this.audioContext,n.path,n.config),this.currentInstrumentName=t,this.ready=!0,console.log(`Audio service initialized with ${t}`)}catch(n){throw console.error("Failed to initialize audio service:",n),n}}getInstrumentLoadOptions(t){return t==="electric_piano_1"?{path:"/music-touchpad/soundfonts/electric_piano_1-mp3.js",config:{gain:2}}:{path:t,config:{format:"mp3",soundfont:"MusyngKite",gain:2}}}async changeInstrument(t){try{this.stopAllNotes(),this.ready=!1,this.audioContext||(this.audioContext=new AudioContext);const n=this.getInstrumentLoadOptions(t);this.instrument=await dt.instrument(this.audioContext,n.path,n.config),this.currentInstrumentName=t,this.ready=!0,console.log(`Changed instrument to ${t}`)}catch(n){throw console.error("Failed to change instrument:",n),n}}playNote(t){if(!this.instrument||!this.ready){console.warn("Audio service not ready");return}if(this.activeNotes.has(t))return;const n=An.has(this.currentInstrumentName),r={gain:2,loop:n};n&&(r.loopStart=.3,r.loopEnd=2.5);const o=this.instrument.play(t,0,r);this.activeNotes.set(t,o)}stopNote(t){const n=this.activeNotes.get(t);n&&(n.stop(),this.activeNotes.delete(t))}stopAllNotes(){this.activeNotes.forEach(t=>t.stop()),this.activeNotes.clear()}isReady(){return this.ready}setPitchBend(t,n){const r=this.activeNotes.get(t);if(r)try{r.source&&r.source.detune&&(r.source.detune.value=n)}catch(o){console.warn("Failed to apply pitch bend:",o)}}getAudioContext(){return this.audioContext}}const H=new Cn,$={instrument:"electric_piano_1",presetId:"harpejji-compact",showLabels:!1,highlightMode:"piano"};function ft(e,t,n){return(t.col-e.col)*(n.row-e.row)-(t.row-e.row)*(n.col-e.col)}function En(e){if(e.length<3)return e.slice();const t=e.slice().sort((o,i)=>o.col!==i.col?o.col-i.col:o.row-i.row),n=[];for(const o of t){for(;n.length>=2&&ft(n[n.length-2],n[n.length-1],o)<=0;)n.pop();n.push(o)}const r=[];for(let o=t.length-1;o>=0;o--){const i=t[o];for(;r.length>=2&&ft(r[r.length-2],r[r.length-1],i)<=0;)r.pop();r.push(i)}return n.pop(),r.pop(),n.concat(r)}function Sn(e,t,n){const r=n.querySelector(`[data-position="${e}-${t}"]`);if(!r)return null;const o=r.getBoundingClientRect(),i=n.getBoundingClientRect(),s=o.left-i.left,l=o.top-i.top,a=s+o.width,c=l+o.height;return[{x:s,y:l},{x:a,y:l},{x:a,y:c},{x:s,y:c}]}function _n(e,t){if(e.length<3)return"";const n=[];for(const a of e){const c=Sn(a.row,a.col,t);c&&n.push(...c)}if(n.length<3)return"";const r=n.slice().sort((a,c)=>a.x!==c.x?a.x-c.x:a.y-c.y),o=[];for(const a of r){for(;o.length>=2&&(o[o.length-1].x-o[o.length-2].x)*(a.y-o[o.length-2].y)-(o[o.length-1].y-o[o.length-2].y)*(a.x-o[o.length-2].x)<=0;)o.pop();o.push(a)}const i=[];for(let a=r.length-1;a>=0;a--){const c=r[a];for(;i.length>=2&&(i[i.length-1].x-i[i.length-2].x)*(c.y-i[i.length-2].y)-(i[i.length-1].y-i[i.length-2].y)*(c.x-i[i.length-2].x)<=0;)i.pop();i.push(c)}o.pop(),i.pop();const s=o.concat(i);return s.length<3?"":s.map((a,c)=>`${c===0?"M":"L"} ${a.x} ${a.y}`).join(" ")+" Z"}const St=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function ae(e){const t=e.match(/^([A-G])([#b]?)(\d+)$/);if(!t)throw new Error(`Invalid note name: ${e}`);const[,n,r,o]=t;let i=parseInt(o),s=n;if(r==="b"){const a={Cb:"B",Db:"C#",Eb:"D#",Fb:"E",Gb:"F#",Ab:"G#",Bb:"A#"},c=n+"b";s=a[c]||n,c==="Cb"&&i--}else r==="#"&&(s=n+"#");const l=St.indexOf(s);if(l===-1)throw new Error(`Invalid note name: ${e}`);return(i+1)*12+l}function re(e){const t=Math.floor(e/12)-1,n=e%12;return`${St[n]}${t}`}class Ln{container;activeButtons=new Set;showLabels=$.showLabels;currentPreset=null;dragStartX=new Map;noteToTouchId=new Map;touchIdToNote=new Map;mouseControlledNote=null;mouseControlledPosition=null;touchIdToPosition=new Map;buttonPositions=new Map;documentMouseMoveHandler=null;documentMouseUpHandler=null;documentTouchMoveHandler=null;documentTouchEndHandler=null;documentTouchCancelHandler=null;playingAreaSvg=null;playingAreaOffset=0;playingArea=[];playingAreaVisible=!1;onNoteStartCallback=null;constructor(t){const n=document.getElementById(t);if(!n)throw new Error(`Container element with id "${t}" not found`);this.container=n,this.setupDocumentEventListeners(),this.setupOrientationChangeListener()}setupOrientationChangeListener(){let t;window.addEventListener("resize",()=>{t&&clearTimeout(t),t=window.setTimeout(()=>{this.currentPreset&&this.render(this.currentPreset)},150)})}isPortraitMode(){return window.innerHeight>window.innerWidth}isFormControl(t){if(!t||!(t instanceof HTMLElement))return!1;const n=t.tagName.toLowerCase();return n==="select"||n==="input"||n==="textarea"||n==="label"||n==="dialog"||n==="button"&&!t.classList.contains("pad-button")||t.closest("select, input, textarea, label, dialog, .burger-menu, .close-button")!==null}getButtonAtPoint(t,n){const r=document.elementFromPoint(t,n);if(r&&r.classList.contains("pad-button")){const o=r.getAttribute("data-note"),i=r.getAttribute("data-position");if(o&&i){const s=this.buttonPositions.get(i);if(s)return{button:r,note:o,position:s}}}return null}isImmediatelyAdjacent(t,n){return t.col===n.col&&Math.abs(t.row-n.row)===1}setupDocumentEventListeners(){this.documentMouseMoveHandler=t=>{this.isFormControl(t.target)||t.preventDefault();const n=this.getButtonAtPoint(t.clientX,t.clientY);if(this.mouseControlledNote&&this.mouseControlledPosition)if(n&&(n.note!==this.mouseControlledNote||n.position.row!==this.mouseControlledPosition.row||n.position.col!==this.mouseControlledPosition.col)&&this.isImmediatelyAdjacent(this.mouseControlledPosition,n.position)){const r=this.dragStartX.get(this.mouseControlledNote);this.handleNoteEnd(this.mouseControlledNote),this.handleNoteStart(n.note,n.button,t.clientX,void 0,!0,n.position),r!==void 0&&this.dragStartX.set(n.note,r),this.mouseControlledNote=n.note,this.mouseControlledPosition=n.position}else(n||this.mouseControlledNote)&&this.handleDrag(this.mouseControlledNote,t.clientX)},this.documentMouseUpHandler=t=>{this.isFormControl(t.target)||t.preventDefault(),this.mouseControlledNote&&(this.handleNoteEnd(this.mouseControlledNote),this.mouseControlledNote=null,this.mouseControlledPosition=null)},this.documentTouchMoveHandler=t=>{this.isFormControl(t.target)||t.preventDefault();for(let n=0;n<t.touches.length;n++){const r=t.touches[n],o=this.touchIdToNote.get(r.identifier),i=this.touchIdToPosition.get(r.identifier);if(o&&i){const s=this.getButtonAtPoint(r.clientX,r.clientY);if(s&&(s.note!==o||s.position.row!==i.row||s.position.col!==i.col)&&this.isImmediatelyAdjacent(i,s.position)){const l=this.dragStartX.get(o);this.handleNoteEnd(o,r.identifier),this.handleNoteStart(s.note,s.button,r.clientX,r.identifier,!0,s.position),l!==void 0&&this.dragStartX.set(s.note,l)}else this.activeButtons.has(o)&&this.handleDrag(o,r.clientX,r.identifier)}}},this.documentTouchEndHandler=t=>{this.isFormControl(t.target)||t.preventDefault();for(let n=0;n<t.changedTouches.length;n++){const r=t.changedTouches[n],o=this.touchIdToNote.get(r.identifier);o&&(this.handleNoteEnd(o,r.identifier),this.touchIdToPosition.delete(r.identifier))}},this.documentTouchCancelHandler=t=>{this.isFormControl(t.target)||t.preventDefault();for(let n=0;n<t.changedTouches.length;n++){const r=t.changedTouches[n],o=this.touchIdToNote.get(r.identifier);o&&(this.handleNoteEnd(o,r.identifier),this.touchIdToPosition.delete(r.identifier))}},document.addEventListener("mousemove",this.documentMouseMoveHandler),document.addEventListener("mouseup",this.documentMouseUpHandler),document.addEventListener("touchmove",this.documentTouchMoveHandler,{passive:!1}),document.addEventListener("touchend",this.documentTouchEndHandler,{passive:!1}),document.addEventListener("touchcancel",this.documentTouchCancelHandler,{passive:!1})}setShowLabels(t){this.showLabels=t,this.currentPreset&&this.render(this.currentPreset)}render(t){this.currentPreset=t,this.activeButtons.clear(),this.buttonPositions.clear(),this.container.innerHTML="";const n=this.isPortraitMode(),r=n?Math.ceil(t.rows/2):t.rows,o=n?t.rows-r:0;this.container.style.display="grid",this.container.style.gridTemplateRows=`repeat(${r}, 1fr)`,this.container.style.gridTemplateColumns=`repeat(${t.cols}, 1fr)`;const i=r>10||t.cols>10?"2px":"6px";this.container.style.gap=i,this.container.style.width="100%",this.container.style.height="100%";const s=r>10||t.cols>10?"8px":"16px";this.container.style.padding=s,t.buttons.forEach(l=>{if(l.row<o)return;const a={...l,row:l.row-o},c=this.createButton(a,l.row,l.col);this.container.appendChild(c)}),this.playingArea.length>0&&this.highlightPlayingArea(this.playingArea)}createButton(t,n,r){const o=document.createElement("button");o.className="pad-button",o.textContent=this.showLabels?t.label||t.note:"",o.dataset.note=t.note;const i=n!==void 0?n:t.row,s=r!==void 0?r:t.col,l=`${i}-${s}`;return o.dataset.position=l,this.buttonPositions.set(l,{row:i,col:s}),t.color&&(o.style.backgroundColor=t.color),o.style.gridRow=`${t.row+1}`,o.style.gridColumn=`${t.col+1}`,o.addEventListener("mousedown",a=>{a.preventDefault(),this.handleNoteStart(t.note,o,a.clientX,void 0,!1,{row:i,col:s})}),o.addEventListener("touchstart",a=>{if(a.preventDefault(),a.changedTouches.length>0){const c=a.changedTouches[0];this.handleNoteStart(t.note,o,c.clientX,c.identifier,!1,{row:i,col:s})}}),o}handleNoteStart(t,n,r,o,i=!1,s){if(!H.isReady()){console.warn("Audio service not ready");return}if(!this.activeButtons.has(t)&&(this.activeButtons.add(t),n.classList.add("active"),H.playNote(t),i||this.dragStartX.set(t,r),o!==void 0&&s?(this.noteToTouchId.set(t,o),this.touchIdToNote.set(o,t),this.touchIdToPosition.set(o,s)):s&&(this.mouseControlledNote=t,this.mouseControlledPosition=s),this.onNoteStartCallback&&s)){const l=ae(t);this.onNoteStartCallback(t,l,s)}}setOnNoteStartCallback(t){this.onNoteStartCallback=t}getActiveMidiNotes(){return Array.from(this.activeButtons).map(t=>ae(t))}handleDrag(t,n,r){if(r!==void 0&&this.noteToTouchId.get(t)!==r)return;const o=this.dragStartX.get(t);if(o===void 0)return;const i=n-o,s=window.innerWidth,l=1200,a=i/s*l,c=Math.max(-l,Math.min(l,a));H.setPitchBend(t,c)}handleNoteEnd(t,n){n!==void 0&&this.noteToTouchId.get(t)!==n||this.activeButtons.has(t)&&(this.activeButtons.delete(t),this.container.querySelectorAll(`[data-note="${t}"]`).forEach(o=>{o.classList.remove("active")}),H.stopNote(t),this.dragStartX.delete(t),n!==void 0?(this.noteToTouchId.delete(t),this.touchIdToNote.delete(n)):this.mouseControlledNote===t&&(this.mouseControlledNote=null))}stopAll(){this.activeButtons.clear(),H.stopAllNotes(),this.container.querySelectorAll(".pad-button").forEach(n=>n.classList.remove("active"))}setCuePad(t,n){console.log(`[GRID] setCuePad called with row=${t}, col=${n}`);const r=this.container.querySelector(`[data-position="${t}-${n}"]`);if(r){const o=r.getAttribute("data-note");console.log(`[GRID] ✓ Found button at row=${t}, col=${n}, note=${o}, adding learning-cue class`),r.classList.add("learning-cue");const i=r.classList.contains("learning-cue");console.log(`[GRID] learning-cue class ${i?"successfully added":"FAILED TO ADD"}`)}else{console.warn(`[GRID] ✗ Could not find button at row=${t}, col=${n}`);const o=this.container.querySelectorAll(".pad-button");console.log(`[GRID] Total buttons in container: ${o.length}`);const i=Array.from(o).map(s=>s.getAttribute("data-position")).filter(s=>s).slice(0,10);console.log("[GRID] Sample button positions:",i)}}clearCuePad(t,n){const r=this.container.querySelector(`[data-position="${t}-${n}"]`);r&&r.classList.remove("learning-cue")}setCuePadsByMidiNote(t,n){this.clearAllCuePads();const r=new Set(n.map(({row:i,col:s})=>`${i}-${s}`));this.container.querySelectorAll(".pad-button").forEach(i=>{const s=i.getAttribute("data-note"),l=i.getAttribute("data-position");s&&l&&s&&r.has(l)&&ae(s)===t&&(i.classList.add("learning-cue"),console.log(`Setting cue for MIDI ${t} at ${l}`))})}clearAllCuePads(){this.container.querySelectorAll(".pad-button.learning-cue, .pad-button.learning-cue-missed").forEach(n=>{n.classList.remove("learning-cue"),n.classList.remove("learning-cue-missed")})}flashMissedCue(){this.container.querySelectorAll(".pad-button.learning-cue").forEach(n=>{n.classList.remove("learning-cue"),n.classList.add("learning-cue-missed")}),setTimeout(()=>{this.container.querySelectorAll(".pad-button.learning-cue-missed").forEach(r=>{r.classList.remove("learning-cue-missed"),r.classList.add("learning-cue")})},400)}highlightPlayingArea(t){this.playingArea=t,this.playingAreaSvg&&(this.playingAreaSvg.remove(),this.playingAreaSvg=null);const n=this.applyPlayingAreaOffset(t),r=En(n);if(r.length<3){console.warn("Not enough points to create convex hull");return}const o=this.createConvexHullOverlay(r);o.style.display=this.playingAreaVisible?"block":"none"}applyPlayingAreaOffset(t){const n=-2*this.playingAreaOffset,r=-1*this.playingAreaOffset;return t.map(({row:o,col:i})=>({row:o+n,col:i+r})).filter(({row:o,col:i})=>this.currentPreset?o>=0&&o<this.currentPreset.rows&&i>=0&&i<this.currentPreset.cols:!1)}createConvexHullOverlay(t){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.zIndex="10";const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("fill","rgba(255, 255, 255, 0.15)"),r.setAttribute("stroke","rgba(255, 255, 255, 0.4)"),r.setAttribute("stroke-width","2"),r.setAttribute("stroke-linejoin","round");const o=_n(t,this.container);return r.setAttribute("d",o),n.appendChild(r),this.container.style.position="relative",this.container.appendChild(n),this.playingAreaSvg=n,n}setPlayingAreaOffset(t){this.playingAreaOffset=t}getPlayingAreaOffset(){return this.playingAreaOffset}setPlayingAreaVisible(t){this.playingAreaVisible=t,this.playingAreaSvg&&(this.playingAreaSvg.style.display=t?"block":"none")}destroy(){this.documentMouseMoveHandler&&document.removeEventListener("mousemove",this.documentMouseMoveHandler),this.documentMouseUpHandler&&document.removeEventListener("mouseup",this.documentMouseUpHandler),this.documentTouchMoveHandler&&document.removeEventListener("touchmove",this.documentTouchMoveHandler),this.documentTouchEndHandler&&document.removeEventListener("touchend",this.documentTouchEndHandler),this.documentTouchCancelHandler&&document.removeEventListener("touchcancel",this.documentTouchCancelHandler),this.stopAll()}}class Nn{container;config;onPresetChange;currentPresetId;constructor(t,n,r){const o=document.getElementById(t);if(!o)throw new Error(`Container element with id "${t}" not found`);this.container=o,this.config=n,this.onPresetChange=r,this.currentPresetId=n.defaultPresetId}render(){this.container.innerHTML="";const t=document.createElement("label");t.textContent="Layout: ",t.htmlFor="preset-select";const n=document.createElement("select");n.id="preset-select",n.className="preset-select",this.config.presets.forEach(r=>{const o=document.createElement("option");o.value=r.id,o.textContent=r.name,o.selected=r.id===this.currentPresetId,n.appendChild(o)}),n.addEventListener("change",r=>{const i=r.target.value;this.selectPreset(i)}),this.container.appendChild(t),this.container.appendChild(n)}selectPreset(t){const n=this.config.presets.find(r=>r.id===t);n?(this.currentPresetId=t,this.onPresetChange(n)):console.error(`Preset with id "${t}" not found`)}getCurrentPreset(){return this.config.presets.find(t=>t.id===this.currentPresetId)}}function He(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=e.match(/^([A-G]#?)(\d+)$/);if(!n)throw new Error(`Invalid note name: ${e}`);const[,r,o]=n,i=parseInt(o),s=t.indexOf(r);if(s===-1)throw new Error(`Invalid note name: ${e}`);return(i+1)*12+s}function Ye(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=Math.floor(e/12)-1,r=e%12;return`${t[r]}${n}`}function _t(e,t,n){const r=e.includes("#"),i={0:0,1:0,2:0,3:30,4:60,5:150,6:180,7:240,8:280,9:280}[t]??240;if(n==="piano")return r?`hsl(${i}, 25%, 28%)`:`hsl(${i}, 30%, 35%)`;{const s=`${e}${t}`;return["E2","A2","D3","G3","B3","E4"].includes(s)?`hsl(${i}, 30%, 35%)`:`hsl(${i}, 25%, 28%)`}}function Fe(e="C4",t="piano"){const n=[],r=He(e),o=24;for(let i=0;i<o;i++){const s=Math.floor(i/6),l=i%6,a=r+i,c=Ye(a),d=parseInt(c.match(/\d+/)?.[0]??"4"),u=c.replace(/\d+/,"");n.push({row:s,col:l,note:c,label:c,color:_t(u,d,t)})}return n}function W(e,t="piano"){const n=[],r=He(e.defaultLowestNote);for(let o=0;o<e.rows;o++)for(let i=0;i<e.cols;i++){const s=r+i*2+o,l=Ye(s),a=parseInt(l.match(/\d+/)?.[0]??"4"),c=l.replace(/\d+/,""),d=_t(c,a,t);n.push({row:e.rows-1-o,col:i,note:l,label:l,color:d})}return{...e,buttons:n}}const ne={presets:[{id:"chromatic",name:"Chromatic Scale",rows:4,cols:6,defaultLowestNote:"C4",buttons:Fe("C4",$.highlightMode)},W({id:"harpejji",name:"Harpejji",rows:16,cols:19,defaultLowestNote:"C2"},$.highlightMode),W({id:"harpejji-compact",name:"Harpejji Compact",rows:12,cols:15,defaultLowestNote:"C3"},$.highlightMode),W({id:"harpejji-mobile",name:"Harpejji Mobile",rows:7,cols:9,defaultLowestNote:"F3"},$.highlightMode)],defaultPresetId:$.presetId,highlightMode:$.highlightMode,updateLowestNote(e){this.presets[0].buttons=Fe(e,this.highlightMode),this.presets[1]=W({...this.presets[1],defaultLowestNote:e},this.highlightMode),this.presets[2]=W({...this.presets[2],defaultLowestNote:e},this.highlightMode),this.presets[3]=W({...this.presets[3],defaultLowestNote:e},this.highlightMode)},updateHighlightMode(e){this.highlightMode=e,this.presets[0].buttons=Fe(this.presets[0].defaultLowestNote,e),this.presets[1]=W({...this.presets[1]},e),this.presets[2]=W({...this.presets[2]},e),this.presets[3]=W({...this.presets[3]},e)}},In="1.0.1";function Mn(e,t,n,r){return Ye(n+e*2+(r-1-t))}function z(e,t=12,n=15){const r=He(e),o=(p,h)=>Mn(p,h,r,t).length===2,i=(p,h)=>p>=-5&&p<n+5&&h>=-5&&h<t+5,s=Math.round(n/2),l=Math.round(t/2),a=[{row:l,col:s}],c=new Set,d=[],u=(p,h)=>`${p},${h}`;for(c.add(u(l,s));a.length>0;){const p=a.shift();d.push(p);const{row:h,col:g}=p,f=o(g,h),m=[];f?(m.push({row:h,col:g+1}),m.push({row:h+1,col:g}),m.push({row:h,col:g-1}),m.push({row:h-1,col:g})):(m.push({row:h+1,col:g}),m.push({row:h,col:g+1}));for(const v of m){const{row:y,col:C}=v,A=u(y,C);c.has(A)||!i(C,y)||(f?y===h-1?o(C,y)||(c.add(A),a.push(v)):o(C,y)&&(c.add(A),a.push(v)):(y===h+1||C===g+1&&o(C,y))&&(c.add(A),a.push(v)))}}return d}/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */function Lt(e){return typeof e>"u"||e===null}function Tn(e){return typeof e=="object"&&e!==null}function Pn(e){return Array.isArray(e)?e:Lt(e)?[]:[e]}function kn(e,t){var n,r,o,i;if(t)for(i=Object.keys(t),n=0,r=i.length;n<r;n+=1)o=i[n],e[o]=t[o];return e}function On(e,t){var n="",r;for(r=0;r<t;r+=1)n+=e;return n}function Bn(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Dn=Lt,Fn=Tn,$n=Pn,jn=On,Rn=Bn,qn=kn,q={isNothing:Dn,isObject:Fn,toArray:$n,repeat:jn,isNegativeZero:Rn,extend:qn};function Nt(e,t){var n="",r=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+=`

`+e.mark.snippet),r+" "+n):r}function de(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=Nt(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}de.prototype=Object.create(Error.prototype);de.prototype.constructor=de;de.prototype.toString=function(t){return this.name+": "+Nt(this,t)};var K=de;function $e(e,t,n,r,o){var i="",s="",l=Math.floor(o/2)-1;return r-t>l&&(i=" ... ",t=r-l+i.length),n-r>l&&(s=" ...",n=r+l-s.length),{str:i+e.slice(t,n).replace(/\t/g,"→")+s,pos:r-t+i.length}}function je(e,t){return q.repeat(" ",t-e.length)+e}function Gn(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),typeof t.indent!="number"&&(t.indent=1),typeof t.linesBefore!="number"&&(t.linesBefore=3),typeof t.linesAfter!="number"&&(t.linesAfter=2);for(var n=/\r?\n|\r|\0/g,r=[0],o=[],i,s=-1;i=n.exec(e.buffer);)o.push(i.index),r.push(i.index+i[0].length),e.position<=i.index&&s<0&&(s=r.length-2);s<0&&(s=r.length-1);var l="",a,c,d=Math.min(e.line+t.linesAfter,o.length).toString().length,u=t.maxLength-(t.indent+d+3);for(a=1;a<=t.linesBefore&&!(s-a<0);a++)c=$e(e.buffer,r[s-a],o[s-a],e.position-(r[s]-r[s-a]),u),l=q.repeat(" ",t.indent)+je((e.line-a+1).toString(),d)+" | "+c.str+`
`+l;for(c=$e(e.buffer,r[s],o[s],e.position,u),l+=q.repeat(" ",t.indent)+je((e.line+1).toString(),d)+" | "+c.str+`
`,l+=q.repeat("-",t.indent+d+3+c.pos)+`^
`,a=1;a<=t.linesAfter&&!(s+a>=o.length);a++)c=$e(e.buffer,r[s+a],o[s+a],e.position-(r[s]-r[s+a]),u),l+=q.repeat(" ",t.indent)+je((e.line+a+1).toString(),d)+" | "+c.str+`
`;return l.replace(/\n$/,"")}var Hn=Gn,Yn=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Un=["scalar","sequence","mapping"];function Vn(e){var t={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(r){t[String(r)]=n})}),t}function Xn(e,t){if(t=t||{},Object.keys(t).forEach(function(n){if(Yn.indexOf(n)===-1)throw new K('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(n){return n},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=Vn(t.styleAliases||null),Un.indexOf(this.kind)===-1)throw new K('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var R=Xn;function ht(e,t){var n=[];return e[t].forEach(function(r){var o=n.length;n.forEach(function(i,s){i.tag===r.tag&&i.kind===r.kind&&i.multi===r.multi&&(o=s)}),n[o]=r}),n}function Wn(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},t,n;function r(o){o.multi?(e.multi[o.kind].push(o),e.multi.fallback.push(o)):e[o.kind][o.tag]=e.fallback[o.tag]=o}for(t=0,n=arguments.length;t<n;t+=1)arguments[t].forEach(r);return e}function qe(e){return this.extend(e)}qe.prototype.extend=function(t){var n=[],r=[];if(t instanceof R)r.push(t);else if(Array.isArray(t))r=r.concat(t);else if(t&&(Array.isArray(t.implicit)||Array.isArray(t.explicit)))t.implicit&&(n=n.concat(t.implicit)),t.explicit&&(r=r.concat(t.explicit));else throw new K("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(i){if(!(i instanceof R))throw new K("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(i.loadKind&&i.loadKind!=="scalar")throw new K("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(i.multi)throw new K("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(i){if(!(i instanceof R))throw new K("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(qe.prototype);return o.implicit=(this.implicit||[]).concat(n),o.explicit=(this.explicit||[]).concat(r),o.compiledImplicit=ht(o,"implicit"),o.compiledExplicit=ht(o,"explicit"),o.compiledTypeMap=Wn(o.compiledImplicit,o.compiledExplicit),o};var zn=qe,Kn=new R("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Jn=new R("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Zn=new R("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Qn=new zn({explicit:[Kn,Jn,Zn]});function eo(e){if(e===null)return!0;var t=e.length;return t===1&&e==="~"||t===4&&(e==="null"||e==="Null"||e==="NULL")}function to(){return null}function no(e){return e===null}var oo=new R("tag:yaml.org,2002:null",{kind:"scalar",resolve:eo,construct:to,predicate:no,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function ro(e){if(e===null)return!1;var t=e.length;return t===4&&(e==="true"||e==="True"||e==="TRUE")||t===5&&(e==="false"||e==="False"||e==="FALSE")}function io(e){return e==="true"||e==="True"||e==="TRUE"}function so(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var lo=new R("tag:yaml.org,2002:bool",{kind:"scalar",resolve:ro,construct:io,predicate:so,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function ao(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function co(e){return 48<=e&&e<=55}function uo(e){return 48<=e&&e<=57}function fo(e){if(e===null)return!1;var t=e.length,n=0,r=!1,o;if(!t)return!1;if(o=e[n],(o==="-"||o==="+")&&(o=e[++n]),o==="0"){if(n+1===t)return!0;if(o=e[++n],o==="b"){for(n++;n<t;n++)if(o=e[n],o!=="_"){if(o!=="0"&&o!=="1")return!1;r=!0}return r&&o!=="_"}if(o==="x"){for(n++;n<t;n++)if(o=e[n],o!=="_"){if(!ao(e.charCodeAt(n)))return!1;r=!0}return r&&o!=="_"}if(o==="o"){for(n++;n<t;n++)if(o=e[n],o!=="_"){if(!co(e.charCodeAt(n)))return!1;r=!0}return r&&o!=="_"}}if(o==="_")return!1;for(;n<t;n++)if(o=e[n],o!=="_"){if(!uo(e.charCodeAt(n)))return!1;r=!0}return!(!r||o==="_")}function ho(e){var t=e,n=1,r;if(t.indexOf("_")!==-1&&(t=t.replace(/_/g,"")),r=t[0],(r==="-"||r==="+")&&(r==="-"&&(n=-1),t=t.slice(1),r=t[0]),t==="0")return 0;if(r==="0"){if(t[1]==="b")return n*parseInt(t.slice(2),2);if(t[1]==="x")return n*parseInt(t.slice(2),16);if(t[1]==="o")return n*parseInt(t.slice(2),8)}return n*parseInt(t,10)}function po(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!q.isNegativeZero(e)}var go=new R("tag:yaml.org,2002:int",{kind:"scalar",resolve:fo,construct:ho,predicate:po,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),mo=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function vo(e){return!(e===null||!mo.test(e)||e[e.length-1]==="_")}function wo(e){var t,n;return t=e.replace(/_/g,"").toLowerCase(),n=t[0]==="-"?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),t===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t===".nan"?NaN:n*parseFloat(t,10)}var yo=/^[-+]?[0-9]+e/;function xo(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(q.isNegativeZero(e))return"-0.0";return n=e.toString(10),yo.test(n)?n.replace("e",".e"):n}function bo(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||q.isNegativeZero(e))}var Ao=new R("tag:yaml.org,2002:float",{kind:"scalar",resolve:vo,construct:wo,predicate:bo,represent:xo,defaultStyle:"lowercase"}),Co=Qn.extend({implicit:[oo,lo,go,Ao]}),Eo=Co,It=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Mt=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function So(e){return e===null?!1:It.exec(e)!==null||Mt.exec(e)!==null}function _o(e){var t,n,r,o,i,s,l,a=0,c=null,d,u,p;if(t=It.exec(e),t===null&&(t=Mt.exec(e)),t===null)throw new Error("Date resolve error");if(n=+t[1],r=+t[2]-1,o=+t[3],!t[4])return new Date(Date.UTC(n,r,o));if(i=+t[4],s=+t[5],l=+t[6],t[7]){for(a=t[7].slice(0,3);a.length<3;)a+="0";a=+a}return t[9]&&(d=+t[10],u=+(t[11]||0),c=(d*60+u)*6e4,t[9]==="-"&&(c=-c)),p=new Date(Date.UTC(n,r,o,i,s,l,a)),c&&p.setTime(p.getTime()-c),p}function Lo(e){return e.toISOString()}var No=new R("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:So,construct:_o,instanceOf:Date,represent:Lo});function Io(e){return e==="<<"||e===null}var Mo=new R("tag:yaml.org,2002:merge",{kind:"scalar",resolve:Io}),Ue=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function To(e){if(e===null)return!1;var t,n,r=0,o=e.length,i=Ue;for(n=0;n<o;n++)if(t=i.indexOf(e.charAt(n)),!(t>64)){if(t<0)return!1;r+=6}return r%8===0}function Po(e){var t,n,r=e.replace(/[\r\n=]/g,""),o=r.length,i=Ue,s=0,l=[];for(t=0;t<o;t++)t%4===0&&t&&(l.push(s>>16&255),l.push(s>>8&255),l.push(s&255)),s=s<<6|i.indexOf(r.charAt(t));return n=o%4*6,n===0?(l.push(s>>16&255),l.push(s>>8&255),l.push(s&255)):n===18?(l.push(s>>10&255),l.push(s>>2&255)):n===12&&l.push(s>>4&255),new Uint8Array(l)}function ko(e){var t="",n=0,r,o,i=e.length,s=Ue;for(r=0;r<i;r++)r%3===0&&r&&(t+=s[n>>18&63],t+=s[n>>12&63],t+=s[n>>6&63],t+=s[n&63]),n=(n<<8)+e[r];return o=i%3,o===0?(t+=s[n>>18&63],t+=s[n>>12&63],t+=s[n>>6&63],t+=s[n&63]):o===2?(t+=s[n>>10&63],t+=s[n>>4&63],t+=s[n<<2&63],t+=s[64]):o===1&&(t+=s[n>>2&63],t+=s[n<<4&63],t+=s[64],t+=s[64]),t}function Oo(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Bo=new R("tag:yaml.org,2002:binary",{kind:"scalar",resolve:To,construct:Po,predicate:Oo,represent:ko}),Do=Object.prototype.hasOwnProperty,Fo=Object.prototype.toString;function $o(e){if(e===null)return!0;var t=[],n,r,o,i,s,l=e;for(n=0,r=l.length;n<r;n+=1){if(o=l[n],s=!1,Fo.call(o)!=="[object Object]")return!1;for(i in o)if(Do.call(o,i))if(!s)s=!0;else return!1;if(!s)return!1;if(t.indexOf(i)===-1)t.push(i);else return!1}return!0}function jo(e){return e!==null?e:[]}var Ro=new R("tag:yaml.org,2002:omap",{kind:"sequence",resolve:$o,construct:jo}),qo=Object.prototype.toString;function Go(e){if(e===null)return!0;var t,n,r,o,i,s=e;for(i=new Array(s.length),t=0,n=s.length;t<n;t+=1){if(r=s[t],qo.call(r)!=="[object Object]"||(o=Object.keys(r),o.length!==1))return!1;i[t]=[o[0],r[o[0]]]}return!0}function Ho(e){if(e===null)return[];var t,n,r,o,i,s=e;for(i=new Array(s.length),t=0,n=s.length;t<n;t+=1)r=s[t],o=Object.keys(r),i[t]=[o[0],r[o[0]]];return i}var Yo=new R("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Go,construct:Ho}),Uo=Object.prototype.hasOwnProperty;function Vo(e){if(e===null)return!0;var t,n=e;for(t in n)if(Uo.call(n,t)&&n[t]!==null)return!1;return!0}function Xo(e){return e!==null?e:{}}var Wo=new R("tag:yaml.org,2002:set",{kind:"mapping",resolve:Vo,construct:Xo}),zo=Eo.extend({implicit:[No,Mo],explicit:[Bo,Ro,Yo,Wo]}),ee=Object.prototype.hasOwnProperty,pe=1,Tt=2,Pt=3,ge=4,Re=1,Ko=2,pt=3,Jo=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Zo=/[\x85\u2028\u2029]/,Qo=/[,\[\]\{\}]/,kt=/^(?:!|!!|![a-z\-]+!)$/i,Ot=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function gt(e){return Object.prototype.toString.call(e)}function X(e){return e===10||e===13}function oe(e){return e===9||e===32}function G(e){return e===9||e===32||e===10||e===13}function se(e){return e===44||e===91||e===93||e===123||e===125}function er(e){var t;return 48<=e&&e<=57?e-48:(t=e|32,97<=t&&t<=102?t-97+10:-1)}function tr(e){return e===120?2:e===117?4:e===85?8:0}function nr(e){return 48<=e&&e<=57?e-48:-1}function mt(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?" ":e===76?"\u2028":e===80?"\u2029":""}function or(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var Bt=new Array(256),Dt=new Array(256);for(var ie=0;ie<256;ie++)Bt[ie]=mt(ie)?1:0,Dt[ie]=mt(ie);function rr(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||zo,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Ft(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=Hn(n),new K(t,n)}function x(e,t){throw Ft(e,t)}function me(e,t){e.onWarning&&e.onWarning.call(null,Ft(e,t))}var vt={YAML:function(t,n,r){var o,i,s;t.version!==null&&x(t,"duplication of %YAML directive"),r.length!==1&&x(t,"YAML directive accepts exactly one argument"),o=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),o===null&&x(t,"ill-formed argument of the YAML directive"),i=parseInt(o[1],10),s=parseInt(o[2],10),i!==1&&x(t,"unacceptable YAML version of the document"),t.version=r[0],t.checkLineBreaks=s<2,s!==1&&s!==2&&me(t,"unsupported YAML version of the document")},TAG:function(t,n,r){var o,i;r.length!==2&&x(t,"TAG directive accepts exactly two arguments"),o=r[0],i=r[1],kt.test(o)||x(t,"ill-formed tag handle (first argument) of the TAG directive"),ee.call(t.tagMap,o)&&x(t,'there is a previously declared suffix for "'+o+'" tag handle'),Ot.test(i)||x(t,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch{x(t,"tag prefix is malformed: "+i)}t.tagMap[o]=i}};function Q(e,t,n,r){var o,i,s,l;if(t<n){if(l=e.input.slice(t,n),r)for(o=0,i=l.length;o<i;o+=1)s=l.charCodeAt(o),s===9||32<=s&&s<=1114111||x(e,"expected valid JSON character");else Jo.test(l)&&x(e,"the stream contains non-printable characters");e.result+=l}}function wt(e,t,n,r){var o,i,s,l;for(q.isObject(n)||x(e,"cannot merge mappings; the provided source object is unacceptable"),o=Object.keys(n),s=0,l=o.length;s<l;s+=1)i=o[s],ee.call(t,i)||(t[i]=n[i],r[i]=!0)}function le(e,t,n,r,o,i,s,l,a){var c,d;if(Array.isArray(o))for(o=Array.prototype.slice.call(o),c=0,d=o.length;c<d;c+=1)Array.isArray(o[c])&&x(e,"nested arrays are not supported inside keys"),typeof o=="object"&&gt(o[c])==="[object Object]"&&(o[c]="[object Object]");if(typeof o=="object"&&gt(o)==="[object Object]"&&(o="[object Object]"),o=String(o),t===null&&(t={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(i))for(c=0,d=i.length;c<d;c+=1)wt(e,t,i[c],n);else wt(e,t,i,n);else!e.json&&!ee.call(n,o)&&ee.call(t,o)&&(e.line=s||e.line,e.lineStart=l||e.lineStart,e.position=a||e.position,x(e,"duplicated mapping key")),o==="__proto__"?Object.defineProperty(t,o,{configurable:!0,enumerable:!0,writable:!0,value:i}):t[o]=i,delete n[o];return t}function Ve(e){var t;t=e.input.charCodeAt(e.position),t===10?e.position++:t===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):x(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function D(e,t,n){for(var r=0,o=e.input.charCodeAt(e.position);o!==0;){for(;oe(o);)o===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),o=e.input.charCodeAt(++e.position);if(t&&o===35)do o=e.input.charCodeAt(++e.position);while(o!==10&&o!==13&&o!==0);if(X(o))for(Ve(e),o=e.input.charCodeAt(e.position),r++,e.lineIndent=0;o===32;)e.lineIndent++,o=e.input.charCodeAt(++e.position);else break}return n!==-1&&r!==0&&e.lineIndent<n&&me(e,"deficient indentation"),r}function ve(e){var t=e.position,n;return n=e.input.charCodeAt(t),!!((n===45||n===46)&&n===e.input.charCodeAt(t+1)&&n===e.input.charCodeAt(t+2)&&(t+=3,n=e.input.charCodeAt(t),n===0||G(n)))}function Xe(e,t){t===1?e.result+=" ":t>1&&(e.result+=q.repeat(`
`,t-1))}function ir(e,t,n){var r,o,i,s,l,a,c,d,u=e.kind,p=e.result,h;if(h=e.input.charCodeAt(e.position),G(h)||se(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(o=e.input.charCodeAt(e.position+1),G(o)||n&&se(o)))return!1;for(e.kind="scalar",e.result="",i=s=e.position,l=!1;h!==0;){if(h===58){if(o=e.input.charCodeAt(e.position+1),G(o)||n&&se(o))break}else if(h===35){if(r=e.input.charCodeAt(e.position-1),G(r))break}else{if(e.position===e.lineStart&&ve(e)||n&&se(h))break;if(X(h))if(a=e.line,c=e.lineStart,d=e.lineIndent,D(e,!1,-1),e.lineIndent>=t){l=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=s,e.line=a,e.lineStart=c,e.lineIndent=d;break}}l&&(Q(e,i,s,!1),Xe(e,e.line-a),i=s=e.position,l=!1),oe(h)||(s=e.position+1),h=e.input.charCodeAt(++e.position)}return Q(e,i,s,!1),e.result?!0:(e.kind=u,e.result=p,!1)}function sr(e,t){var n,r,o;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(Q(e,r,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)r=e.position,e.position++,o=e.position;else return!0;else X(n)?(Q(e,r,o,!0),Xe(e,D(e,!1,t)),r=o=e.position):e.position===e.lineStart&&ve(e)?x(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);x(e,"unexpected end of the stream within a single quoted scalar")}function lr(e,t){var n,r,o,i,s,l;if(l=e.input.charCodeAt(e.position),l!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;(l=e.input.charCodeAt(e.position))!==0;){if(l===34)return Q(e,n,e.position,!0),e.position++,!0;if(l===92){if(Q(e,n,e.position,!0),l=e.input.charCodeAt(++e.position),X(l))D(e,!1,t);else if(l<256&&Bt[l])e.result+=Dt[l],e.position++;else if((s=tr(l))>0){for(o=s,i=0;o>0;o--)l=e.input.charCodeAt(++e.position),(s=er(l))>=0?i=(i<<4)+s:x(e,"expected hexadecimal character");e.result+=or(i),e.position++}else x(e,"unknown escape sequence");n=r=e.position}else X(l)?(Q(e,n,r,!0),Xe(e,D(e,!1,t)),n=r=e.position):e.position===e.lineStart&&ve(e)?x(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}x(e,"unexpected end of the stream within a double quoted scalar")}function ar(e,t){var n=!0,r,o,i,s=e.tag,l,a=e.anchor,c,d,u,p,h,g=Object.create(null),f,m,v,y;if(y=e.input.charCodeAt(e.position),y===91)d=93,h=!1,l=[];else if(y===123)d=125,h=!0,l={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=l),y=e.input.charCodeAt(++e.position);y!==0;){if(D(e,!0,t),y=e.input.charCodeAt(e.position),y===d)return e.position++,e.tag=s,e.anchor=a,e.kind=h?"mapping":"sequence",e.result=l,!0;n?y===44&&x(e,"expected the node content, but found ','"):x(e,"missed comma between flow collection entries"),m=f=v=null,u=p=!1,y===63&&(c=e.input.charCodeAt(e.position+1),G(c)&&(u=p=!0,e.position++,D(e,!0,t))),r=e.line,o=e.lineStart,i=e.position,ce(e,t,pe,!1,!0),m=e.tag,f=e.result,D(e,!0,t),y=e.input.charCodeAt(e.position),(p||e.line===r)&&y===58&&(u=!0,y=e.input.charCodeAt(++e.position),D(e,!0,t),ce(e,t,pe,!1,!0),v=e.result),h?le(e,l,g,m,f,v,r,o,i):u?l.push(le(e,null,g,m,f,v,r,o,i)):l.push(f),D(e,!0,t),y=e.input.charCodeAt(e.position),y===44?(n=!0,y=e.input.charCodeAt(++e.position)):n=!1}x(e,"unexpected end of the stream within a flow collection")}function cr(e,t){var n,r,o=Re,i=!1,s=!1,l=t,a=0,c=!1,d,u;if(u=e.input.charCodeAt(e.position),u===124)r=!1;else if(u===62)r=!0;else return!1;for(e.kind="scalar",e.result="";u!==0;)if(u=e.input.charCodeAt(++e.position),u===43||u===45)Re===o?o=u===43?pt:Ko:x(e,"repeat of a chomping mode identifier");else if((d=nr(u))>=0)d===0?x(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):s?x(e,"repeat of an indentation width identifier"):(l=t+d-1,s=!0);else break;if(oe(u)){do u=e.input.charCodeAt(++e.position);while(oe(u));if(u===35)do u=e.input.charCodeAt(++e.position);while(!X(u)&&u!==0)}for(;u!==0;){for(Ve(e),e.lineIndent=0,u=e.input.charCodeAt(e.position);(!s||e.lineIndent<l)&&u===32;)e.lineIndent++,u=e.input.charCodeAt(++e.position);if(!s&&e.lineIndent>l&&(l=e.lineIndent),X(u)){a++;continue}if(e.lineIndent<l){o===pt?e.result+=q.repeat(`
`,i?1+a:a):o===Re&&i&&(e.result+=`
`);break}for(r?oe(u)?(c=!0,e.result+=q.repeat(`
`,i?1+a:a)):c?(c=!1,e.result+=q.repeat(`
`,a+1)):a===0?i&&(e.result+=" "):e.result+=q.repeat(`
`,a):e.result+=q.repeat(`
`,i?1+a:a),i=!0,s=!0,a=0,n=e.position;!X(u)&&u!==0;)u=e.input.charCodeAt(++e.position);Q(e,n,e.position,!1)}return!0}function yt(e,t){var n,r=e.tag,o=e.anchor,i=[],s,l=!1,a;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=i),a=e.input.charCodeAt(e.position);a!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,x(e,"tab characters must not be used in indentation")),!(a!==45||(s=e.input.charCodeAt(e.position+1),!G(s))));){if(l=!0,e.position++,D(e,!0,-1)&&e.lineIndent<=t){i.push(null),a=e.input.charCodeAt(e.position);continue}if(n=e.line,ce(e,t,Pt,!1,!0),i.push(e.result),D(e,!0,-1),a=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&a!==0)x(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break}return l?(e.tag=r,e.anchor=o,e.kind="sequence",e.result=i,!0):!1}function ur(e,t,n){var r,o,i,s,l,a,c=e.tag,d=e.anchor,u={},p=Object.create(null),h=null,g=null,f=null,m=!1,v=!1,y;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=u),y=e.input.charCodeAt(e.position);y!==0;){if(!m&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,x(e,"tab characters must not be used in indentation")),r=e.input.charCodeAt(e.position+1),i=e.line,(y===63||y===58)&&G(r))y===63?(m&&(le(e,u,p,h,g,null,s,l,a),h=g=f=null),v=!0,m=!0,o=!0):m?(m=!1,o=!0):x(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,y=r;else{if(s=e.line,l=e.lineStart,a=e.position,!ce(e,n,Tt,!1,!0))break;if(e.line===i){for(y=e.input.charCodeAt(e.position);oe(y);)y=e.input.charCodeAt(++e.position);if(y===58)y=e.input.charCodeAt(++e.position),G(y)||x(e,"a whitespace character is expected after the key-value separator within a block mapping"),m&&(le(e,u,p,h,g,null,s,l,a),h=g=f=null),v=!0,m=!1,o=!1,h=e.tag,g=e.result;else if(v)x(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=c,e.anchor=d,!0}else if(v)x(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=c,e.anchor=d,!0}if((e.line===i||e.lineIndent>t)&&(m&&(s=e.line,l=e.lineStart,a=e.position),ce(e,t,ge,!0,o)&&(m?g=e.result:f=e.result),m||(le(e,u,p,h,g,f,s,l,a),h=g=f=null),D(e,!0,-1),y=e.input.charCodeAt(e.position)),(e.line===i||e.lineIndent>t)&&y!==0)x(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return m&&le(e,u,p,h,g,null,s,l,a),v&&(e.tag=c,e.anchor=d,e.kind="mapping",e.result=u),v}function dr(e){var t,n=!1,r=!1,o,i,s;if(s=e.input.charCodeAt(e.position),s!==33)return!1;if(e.tag!==null&&x(e,"duplication of a tag property"),s=e.input.charCodeAt(++e.position),s===60?(n=!0,s=e.input.charCodeAt(++e.position)):s===33?(r=!0,o="!!",s=e.input.charCodeAt(++e.position)):o="!",t=e.position,n){do s=e.input.charCodeAt(++e.position);while(s!==0&&s!==62);e.position<e.length?(i=e.input.slice(t,e.position),s=e.input.charCodeAt(++e.position)):x(e,"unexpected end of the stream within a verbatim tag")}else{for(;s!==0&&!G(s);)s===33&&(r?x(e,"tag suffix cannot contain exclamation marks"):(o=e.input.slice(t-1,e.position+1),kt.test(o)||x(e,"named tag handle cannot contain such characters"),r=!0,t=e.position+1)),s=e.input.charCodeAt(++e.position);i=e.input.slice(t,e.position),Qo.test(i)&&x(e,"tag suffix cannot contain flow indicator characters")}i&&!Ot.test(i)&&x(e,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch{x(e,"tag name is malformed: "+i)}return n?e.tag=i:ee.call(e.tagMap,o)?e.tag=e.tagMap[o]+i:o==="!"?e.tag="!"+i:o==="!!"?e.tag="tag:yaml.org,2002:"+i:x(e,'undeclared tag handle "'+o+'"'),!0}function fr(e){var t,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&x(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;n!==0&&!G(n)&&!se(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&x(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function hr(e){var t,n,r;if(r=e.input.charCodeAt(e.position),r!==42)return!1;for(r=e.input.charCodeAt(++e.position),t=e.position;r!==0&&!G(r)&&!se(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&x(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),ee.call(e.anchorMap,n)||x(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],D(e,!0,-1),!0}function ce(e,t,n,r,o){var i,s,l,a=1,c=!1,d=!1,u,p,h,g,f,m;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,i=s=l=ge===n||Pt===n,r&&D(e,!0,-1)&&(c=!0,e.lineIndent>t?a=1:e.lineIndent===t?a=0:e.lineIndent<t&&(a=-1)),a===1)for(;dr(e)||fr(e);)D(e,!0,-1)?(c=!0,l=i,e.lineIndent>t?a=1:e.lineIndent===t?a=0:e.lineIndent<t&&(a=-1)):l=!1;if(l&&(l=c||o),(a===1||ge===n)&&(pe===n||Tt===n?f=t:f=t+1,m=e.position-e.lineStart,a===1?l&&(yt(e,m)||ur(e,m,f))||ar(e,f)?d=!0:(s&&cr(e,f)||sr(e,f)||lr(e,f)?d=!0:hr(e)?(d=!0,(e.tag!==null||e.anchor!==null)&&x(e,"alias node should not have any properties")):ir(e,f,pe===n)&&(d=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):a===0&&(d=l&&yt(e,m))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&x(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),u=0,p=e.implicitTypes.length;u<p;u+=1)if(g=e.implicitTypes[u],g.resolve(e.result)){e.result=g.construct(e.result),e.tag=g.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(ee.call(e.typeMap[e.kind||"fallback"],e.tag))g=e.typeMap[e.kind||"fallback"][e.tag];else for(g=null,h=e.typeMap.multi[e.kind||"fallback"],u=0,p=h.length;u<p;u+=1)if(e.tag.slice(0,h[u].tag.length)===h[u].tag){g=h[u];break}g||x(e,"unknown tag !<"+e.tag+">"),e.result!==null&&g.kind!==e.kind&&x(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+g.kind+'", not "'+e.kind+'"'),g.resolve(e.result,e.tag)?(e.result=g.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):x(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||d}function pr(e){var t=e.position,n,r,o,i=!1,s;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(s=e.input.charCodeAt(e.position))!==0&&(D(e,!0,-1),s=e.input.charCodeAt(e.position),!(e.lineIndent>0||s!==37));){for(i=!0,s=e.input.charCodeAt(++e.position),n=e.position;s!==0&&!G(s);)s=e.input.charCodeAt(++e.position);for(r=e.input.slice(n,e.position),o=[],r.length<1&&x(e,"directive name must not be less than one character in length");s!==0;){for(;oe(s);)s=e.input.charCodeAt(++e.position);if(s===35){do s=e.input.charCodeAt(++e.position);while(s!==0&&!X(s));break}if(X(s))break;for(n=e.position;s!==0&&!G(s);)s=e.input.charCodeAt(++e.position);o.push(e.input.slice(n,e.position))}s!==0&&Ve(e),ee.call(vt,r)?vt[r](e,r,o):me(e,'unknown document directive "'+r+'"')}if(D(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,D(e,!0,-1)):i&&x(e,"directives end mark is expected"),ce(e,e.lineIndent-1,ge,!1,!0),D(e,!0,-1),e.checkLineBreaks&&Zo.test(e.input.slice(t,e.position))&&me(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ve(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,D(e,!0,-1));return}if(e.position<e.length-1)x(e,"end of the stream or a document separator is expected");else return}function gr(e,t){e=String(e),t=t||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new rr(e,t),r=e.indexOf("\0");for(r!==-1&&(n.position=r,x(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)pr(n);return n.documents}function mr(e,t){var n=gr(e,t);if(n.length!==0){if(n.length===1)return n[0];throw new K("expected a single document in the stream, but found more")}}var vr=mr,wr={load:vr},yr=wr.load;function Dr(e){if(!e)return"C";if(e.length===1)return e.toUpperCase();const t=e.match(/^([a-g])(is|es)?$/);if(!t)return e;const[,n,r]=t;let o=n.toUpperCase();return r==="is"?o+="#":r==="es"&&(o+="b"),o}function xt(e){const t=e.match(/^([a-g])(is|es)?([',]*)?$/);if(!t)throw new Error(`Invalid LilyPond note: ${e}`);const[,n,r,o]=t;let i=n.toUpperCase();r==="is"?i+="#":r==="es"&&(i+="b");let s=3;if(o){const l=(o.match(/'/g)||[]).length,a=(o.match(/,/g)||[]).length;s+=l-a}return`${i}${s}`}class We{rawData;constructor(t){this.rawData=this.parseYaml(t)}parseYaml(t){const n=yr(t);if(n.metadata||(n.metadata={}),!n.preset)throw new Error("Lesson missing required field: preset");if(n.preset!=="harpejji-compact")throw new Error(`Only Harpejji lessons are supported. Got preset: ${n.preset}`);if(!n.lowestNote)throw new Error("Lesson missing required field: lowestNote");if(!n.tempo)throw new Error("Lesson missing required field: tempo");if(!n.voices&&!n.bars)throw new Error("Lesson missing required field: voices (or legacy bars array)");return n}getLowestNote(){return this.rawData.lowestNote}getTempo(){return this.rawData.tempo}getTimeSignature(){return this.rawData.timeSignature||"4/4"}getMetadata(){return this.rawData.metadata}getPreset(){return this.rawData.preset}getScheduledNotes(t,n,r,o){const i=n||this.rawData.lowestNote;let s=[];if(this.rawData.voices){const l=[];for(const[a,c]of Object.entries(this.rawData.voices)){const d=this.parseNoteSequence(c,i,r,o,t,a);l.push(d)}s=this.mergeVoices(l)}else if(this.rawData.bars){for(const l of this.rawData.bars)if(typeof l=="string"){const a=this.parseNoteSequence(l,i,r,o,t);s=s.concat(a)}else if(l.voices){const a=[];for(const[d,u]of Object.entries(l.voices)){const p=this.parseNoteSequence(u,i,r,o,t,d);a.push(p)}const c=this.mergeVoices(a);s=s.concat(c)}}return s}toLessonData(t,n,r,o){const i=n||this.rawData.lowestNote,s=this.getScheduledNotes(t,n,r,o);return{metadata:this.rawData.metadata,preset:this.rawData.preset,lowestNote:i,tempo:this.rawData.tempo,timeSignature:this.getTimeSignature(),key:this.rawData.key||"C",notes:s}}parseDuration(t){const n=t.endsWith(".");let o=4/parseInt(t.replace(".",""));return n&&(o*=1.5),o}resolvePosition(t,n,r,o,i=0,s){if(s.length>0){const l={};for(const m of s){const v=n+m.col*2+(r-1-m.row);l[v]||(l[v]=[]),l[v].push(m)}const a=l[t];if(!a||a.length===0)throw new Error(`Note ${re(t)} (MIDI ${t}) not found in playing area`);const c=a[0];console.log(`[LESSON] Note ${re(t)} base position: row=${c.row}, col=${c.col}, offset=${i}`);const d=c.col+i,u=c.row+i*2;console.log(`[LESSON] Note ${re(t)} target position: row=${u}, col=${d}`);const p=-5,h=o+5;if(u<0||u>=r||d<p||d>=h)throw new Error(`Position out of bounds for MIDI note ${t} (${re(t)}) with offset ${i} - resolved to row=${u}, col=${d} (allowed: row 0-${r-1}, col ${p}-${h-1})`);const g=r-1-u,f=n+d*2+g;if(f!==t)throw new Error(`Offset calculation error: position (row=${u}, col=${d}) produces MIDI ${f} but expected ${t} for ${re(t)} with offset ${i}`);return{row:u,col:d}}throw new Error(`Note ${re(t)} (MIDI ${t}) requires a playing area for position calculation`)}parseNoteWithOffset(t){const n=t.match(/^([a-g](?:is|es)?[',]*)@([+-]?\d+)$/);return n?{lilypondNote:n[1],offset:parseInt(n[2])}:{lilypondNote:t,offset:0}}parseNoteSequence(t,n,r,o,i,s){const l=[];let a=0,c=1;const u=t.replace(/%\{[^}]*\}/g," ").replace(/%[^\s|]+/g," ").replace(/\|/g," ").trim().matchAll(/<[^>]+>(?:\d+\.?)?(?:@[+-]?\d+)?|[^\s<]+/g),p=Array.from(u,f=>f[0]),h=ae(n),g=s&&s.toLowerCase().startsWith("bass")?"bass":"treble";for(const f of p)if(f){if(f.startsWith("r")){const m=f.match(/r(\d+\.?)/);if(m){const v=this.parseDuration(m[1]);l.push({notes:[],startBeat:a,duration:v,isChord:!1,isRest:!0,clef:g}),a+=v,c=v}continue}if(f.startsWith("<")){const m=f.match(/^<([^>]+)>(\d+\.?)?(@[+-]?\d+)?$/);if(!m){console.warn(`Skipping invalid chord token: ${f}`);continue}const[,v,y,C]=m;y&&(c=this.parseDuration(y));const A=C?parseInt(C.substring(1)):0,T=v.trim().split(/\s+/),L=[];for(const b of T){const{lilypondNote:w,offset:I}=this.parseNoteWithOffset(b),N=xt(w),F=ae(N),Y=I+A,Z=this.resolvePosition(F,h,r,o,Y,i);L.push({note:N,midiNote:F,offset:Y,position:Z,voice:s,clef:g})}l.push({notes:L,startBeat:a,duration:c,isChord:!0,isRest:!1}),a+=c}else{const m=f.match(/^([a-g](?:is|es)?[',]*)(\d+\.?)?(@[+-]?\d+)?$/);if(!m){console.warn(`Skipping invalid token: ${f}`);continue}const[,v,y,C]=m;y&&(c=this.parseDuration(y));const A=C?parseInt(C.substring(1)):0,T=xt(v),L=ae(T),b=this.resolvePosition(L,h,r,o,A,i);l.push({notes:[{note:T,midiNote:L,offset:A,position:b,voice:s,clef:g}],startBeat:a,duration:c,isChord:!1,isRest:!1}),a+=c}}return l}mergeVoices(t){const n=[];for(const r of t)n.push(...r);return n.sort((r,o)=>r.startBeat-o.startBeat),n}}const we=["electric_piano_1","electric_piano_2","acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honky_tonk_piano","vibraphone","marimba","xylophone","harpsichord","clavinet","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass"],ye=["G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4"],xe=["chromatic","harpejji","harpejji-compact","harpejji-mobile"];function xr(e){(e.instrumentIndex<0||e.instrumentIndex>=we.length)&&(console.warn(`Invalid instrument index: ${e.instrumentIndex}, clamping to 0`),e.instrumentIndex=0),(e.lowestNoteIndex<0||e.lowestNoteIndex>=ye.length)&&(console.warn(`Invalid lowest note index: ${e.lowestNoteIndex}, clamping to 0`),e.lowestNoteIndex=0),(e.presetIndex<0||e.presetIndex>=xe.length)&&(console.warn(`Invalid preset index: ${e.presetIndex}, clamping to 0`),e.presetIndex=0);const t=e.instrumentIndex.toString(16).padStart(3,"0"),n=e.lowestNoteIndex.toString(16).padStart(2,"0"),r=e.presetIndex.toString(16);let o=0;e.showLabels&&(o|=1),e.showPlayingArea&&(o|=2);const i=o.toString(16),l=(e.highlightMode==="piano"?0:1).toString(16);return`#${t}${n}${r}${i}${l}`}function br(e){const t=e.startsWith("#")?e.slice(1):e;if(!/^[0-9a-fA-F]{7,8}$/.test(t))return null;try{const n=parseInt(t.slice(0,3),16),r=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,6),16),i=parseInt(t.slice(6,7),16),s=(i&1)!==0,l=(i&2)!==0,c=(t.length>=8?parseInt(t.slice(7,8),16):0)===0?"piano":"guitar";return n>=we.length||r>=ye.length||o>=xe.length?(console.warn("Decoded hash contains out-of-range indices, ignoring"),null):{instrumentIndex:n,lowestNoteIndex:r,presetIndex:o,showLabels:s,showPlayingArea:l,highlightMode:c}}catch(n){return console.error("Failed to decode hash:",n),null}}function Ar(e){return we[e]}function Cr(e){const t=we.indexOf(e);return t>=0?t:0}function Er(e){return ye[e]}function Sr(e){const t=ye.indexOf(e);return t>=0?t:0}function _r(e){return xe[e]}function Lr(e){const t=xe.indexOf(e);return t>=0?t:0}class Nr{learningMode=null;lesson=null;lessonName=null;lessonData=null;sheetMusicRendered=!1;grid=null;presetSelector=null;setGrid(t){this.grid=t}getGrid(){return this.grid}setPresetSelector(t){this.presetSelector=t}getPresetSelector(){return this.presetSelector}setLearningMode(t){this.learningMode=t}getLearningMode(){return this.learningMode}setLesson(t,n){this.lesson=t,this.lessonName=n}getLesson(){return this.lesson}getLessonName(){return this.lessonName}setLessonData(t){this.lessonData=t,this.sheetMusicRendered=!1}getLessonData(){return this.lessonData}isSheetMusicRendered(){return this.sheetMusicRendered}markSheetMusicRendered(){this.sheetMusicRendered=!0}hasActiveLesson(){return this.lesson!==null&&this.lessonName!==null&&this.grid!==null}hasActiveLearningMode(){return this.learningMode!==null}clearLesson(){this.learningMode&&this.learningMode.stop(),this.learningMode=null,this.lesson=null,this.lessonName=null,this.lessonData=null,this.sheetMusicRendered=!1;const t=document.getElementById("metronome-toggle");t&&t.classList.remove("visible")}async stopAndClearLearningMode(){const t=this.grid;t&&(this.learningMode&&this.learningMode.stop(),t.clearAllCuePads(),this.learningMode=null,await new Promise(n=>requestAnimationFrame(()=>{requestAnimationFrame(()=>n(void 0))})),t.clearAllCuePads())}}const E=new Nr,$t=[{value:"c-major-scale",name:"C Major Scale"},{value:"candlelight-carol",name:"Candlelight Carol"},{value:"chameleon",name:"Chameleon"},{value:"chord-test",name:"Chord Test"},{value:"combined-test",name:"Combined Test"},{value:"d-major-scale",name:"D Major Scale"},{value:"f-major-scale",name:"F Major Scale"},{value:"offset-test",name:"Offset Test"}];window.appState=E;function te(){const e=document.getElementById("instrument-selector-button"),t=document.getElementById("lowest-note-select"),n=E.getPresetSelector(),r=document.getElementById("show-labels"),o=document.getElementById("show-playing-area");if(!e||!t||!n)return;const i=n.getCurrentPreset();if(!i)return;const s=window.getCurrentInstrument?.()||$.instrument,l=document.getElementById("highlight-mode-select"),a={instrumentIndex:Cr(s),lowestNoteIndex:Sr(t.value),presetIndex:Lr(i.id),showLabels:r?.checked??$.showLabels,showPlayingArea:o?.checked??!1,highlightMode:l?.value??$.highlightMode},d={chromatic:"C4",harpejji:"C2","harpejji-compact":"C3","harpejji-mobile":"F3"}[i.id]??"C3";if(s===$.instrument&&i.id===$.presetId&&t.value===d&&a.showLabels===$.showLabels&&a.showPlayingArea===!1&&a.highlightMode===$.highlightMode)window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search);else{const p=xr(a);window.location.hash!==p&&history.replaceState(null,"",p)}}async function Ir(){const e=document.getElementById("app");if(!e)throw new Error("App container not found");const t=document.getElementById("app-version");t&&(t.textContent=`v${In}`);const n=document.getElementById("burger-menu"),r=document.getElementById("menu-dialog"),o=document.getElementById("close-menu");n&&r&&n.addEventListener("click",()=>{r.showModal()}),o&&r&&o.addEventListener("click",()=>{r.close()}),r&&r.addEventListener("click",g=>{const f=r.getBoundingClientRect();(g.clientX<f.left||g.clientX>f.right||g.clientY<f.top||g.clientY>f.bottom)&&r.close()});const i=document.getElementById("sheet-music-button"),s=document.getElementById("sheet-music-dialog"),l=document.getElementById("close-sheet-music"),a=document.getElementById("reload-lesson");i&&(i.style.display="none");const c=document.getElementById("metronome-toggle");c&&c.addEventListener("click",()=>{const g=E.getLearningMode();if(!g)return;const f=g.isMetronomeEnabled();g.setMetronomeEnabled(!f),f?(c.classList.remove("enabled"),c.classList.add("disabled")):(c.classList.remove("disabled"),c.classList.add("enabled")),console.log(`Metronome ${f?"disabled":"enabled"}`)});const d=document.getElementById("fullscreen-button"),u=d?.querySelector(".fullscreen-enter"),p=d?.querySelector(".fullscreen-exit");if(d&&document.documentElement.requestFullscreen){d.style.display="flex";const g=()=>{const f=!!document.fullscreenElement;u&&p&&(u.style.display=f?"none":"block",p.style.display=f?"block":"none"),d.title=f?"Exit fullscreen":"Enter fullscreen",d.setAttribute("aria-label",f?"Exit fullscreen":"Enter fullscreen")};d.addEventListener("click",async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(f){console.error("Error toggling fullscreen:",f)}}),document.addEventListener("fullscreenchange",g),g()}i&&s&&i.addEventListener("click",async()=>{if(!E.isSheetMusicRendered()){const g=E.getLessonData();g&&await Or(g)}s.showModal()}),l&&s&&l.addEventListener("click",()=>{s.close()}),a&&a.addEventListener("click",async()=>{await Tr()});const h=document.getElementById("lesson-selector");h&&h.addEventListener("change",async g=>{const m=g.target.value;if(!m)return;const v=E.getGrid(),C=E.getPresetSelector()?.getCurrentPreset();if(!v||!C){console.error("Required app state missing for lesson change");return}await Mr(v,C,m)}),s&&s.addEventListener("click",g=>{const f=s.getBoundingClientRect();(g.clientX<f.left||g.clientX>f.right||g.clientY<f.top||g.clientY>f.bottom)&&s.close()});try{await H.initialize($.instrument);const g=document.getElementById("loading-overlay");g&&g.classList.add("hidden");const f=new Ln("grid-container");E.setGrid(f);const m=document.getElementById("instrument-selector"),v=document.getElementById("instrument-dialog"),y=document.getElementById("close-instrument-dialog"),C=document.getElementById("instrument-grid");if(m&&v&&C){const S=[{emoji:"🎹",name:"Piano & Keys",instruments:[{value:"electric_piano_1",name:"Electric Piano (Rhodes)"},{value:"electric_piano_2",name:"Electric Piano (DX7)"},{value:"acoustic_grand_piano",name:"Acoustic Grand Piano"},{value:"bright_acoustic_piano",name:"Bright Acoustic Piano"},{value:"electric_grand_piano",name:"Electric Grand Piano"},{value:"honky_tonk_piano",name:"Honky-Tonk Piano"},{value:"harpsichord",name:"Harpsichord"},{value:"clavinet",name:"Clavinet"},{value:"drawbar_organ",name:"Drawbar Organ"},{value:"percussive_organ",name:"Percussive Organ"},{value:"rock_organ",name:"Rock Organ"},{value:"church_organ",name:"Church Organ"},{value:"reed_organ",name:"Reed Organ"}]},{emoji:"🎵",name:"Mallet Percussion",instruments:[{value:"vibraphone",name:"Vibraphone"},{value:"marimba",name:"Marimba"},{value:"xylophone",name:"Xylophone"}]},{emoji:"🎸",name:"Guitar",instruments:[{value:"acoustic_guitar_nylon",name:"Acoustic Guitar (Nylon)"},{value:"acoustic_guitar_steel",name:"Acoustic Guitar (Steel)"},{value:"electric_guitar_jazz",name:"Electric Guitar (Jazz)"},{value:"electric_guitar_clean",name:"Electric Guitar (Clean)"},{value:"electric_guitar_muted",name:"Electric Guitar (Muted)"},{value:"overdriven_guitar",name:"Overdriven Guitar"},{value:"distortion_guitar",name:"Distortion Guitar"}]},{emoji:"𝄢",name:"Bass",instruments:[{value:"acoustic_bass",name:"Acoustic Bass"},{value:"electric_bass_finger",name:"Electric Bass (Finger)"},{value:"electric_bass_pick",name:"Electric Bass (Pick)"},{value:"fretless_bass",name:"Fretless Bass"}]}];let _=$.instrument;const O=document.createElement("label");O.textContent="Instrument: ";const k=document.createElement("button");k.className="instrument-selector-button",k.id="instrument-selector-button",k.textContent="Electric Piano (Rhodes)",k.addEventListener("click",()=>{v.showModal()}),S.forEach(P=>{const M=document.createElement("div");M.className="instrument-category";const B=document.createElement("div");B.className="instrument-category-header";const j=document.createElement("span");j.className="instrument-category-emoji",j.textContent=P.emoji;const ue=document.createElement("span");ue.textContent=P.name,B.appendChild(j),B.appendChild(ue),M.appendChild(B),P.instruments.forEach(U=>{const V=document.createElement("button");V.className="instrument-button",V.textContent=U.name,V.dataset.value=U.value,U.value===_&&V.classList.add("selected"),V.addEventListener("click",async()=>{C.querySelectorAll(".instrument-button").forEach(Ae=>Ae.classList.remove("selected")),V.classList.add("selected"),k.textContent=U.name,_=U.value,V.disabled=!0,f.stopAll();try{await H.changeInstrument(U.value),V.disabled=!1,te(),v.close()}catch(Ae){console.error("Failed to change instrument:",Ae),V.disabled=!1}}),M.appendChild(V)}),C.appendChild(M)}),y&&y.addEventListener("click",()=>{v.close()}),v.addEventListener("click",P=>{const M=v.getBoundingClientRect();(P.clientX<M.left||P.clientX>M.right||P.clientY<M.top||P.clientY>M.bottom)&&v.close()}),m.appendChild(O),m.appendChild(k),window.updateInstrumentButton=(P,M)=>{_=P,k.textContent=M,C.querySelectorAll(".instrument-button").forEach(j=>{j instanceof HTMLButtonElement&&j.dataset.value===P?j.classList.add("selected"):j.classList.remove("selected")})},window.getCurrentInstrument=()=>_}const A=document.getElementById("lowest-note-selector");if(A){const S=document.createElement("label");S.textContent="Lowest Note: ",S.htmlFor="lowest-note-select";const _=document.createElement("select");_.id="lowest-note-select",_.className="preset-select",["G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4"].forEach(k=>{const P=document.createElement("option");P.value=k,P.textContent=k,_.appendChild(P)}),_.addEventListener("change",async k=>{const M=k.target.value;if(ne.updateLowestNote(M),E.hasActiveLearningMode())console.log("Reloading learning mode with new lowest note"),await Pr();else{const B=I.getCurrentPreset();if(B){f.stopAll(),f.render(B);const j=z(M,B.rows,B.cols);f.highlightPlayingArea(j)}}te()}),A.appendChild(S),A.appendChild(_)}const T=document.getElementById("labels-toggle");if(T){const S=document.createElement("input");S.type="checkbox",S.id="show-labels",S.checked=$.showLabels;const _=document.createElement("label");_.htmlFor="show-labels",_.textContent="Show note names",S.addEventListener("change",O=>{const k=O.target;f.setShowLabels(k.checked),te()}),T.appendChild(S),T.appendChild(_)}const L=document.getElementById("highlight-mode-selector");if(L){const S=document.createElement("label");S.textContent="Highlight: ",S.htmlFor="highlight-mode-select";const _=document.createElement("select");_.id="highlight-mode-select",_.className="preset-select";const O=document.createElement("option");O.value="piano",O.textContent="Piano",_.appendChild(O);const k=document.createElement("option");k.value="guitar",k.textContent="Guitar",_.appendChild(k),_.value=$.highlightMode,_.addEventListener("change",async()=>{const P=_.value;ne.updateHighlightMode(P);const M=I.getCurrentPreset();if(M){f.stopAll(),f.render(M);const B=document.getElementById("lowest-note-select");if(B){const j=z(B.value,M.rows,M.cols);f.highlightPlayingArea(j)}}te()}),L.appendChild(S),L.appendChild(_)}const b=document.getElementById("playing-area-toggle");if(b){const S=document.createElement("input");S.type="checkbox",S.id="show-playing-area",S.checked=!1;const _=document.createElement("label");_.htmlFor="show-playing-area",_.textContent="Show playing area",S.addEventListener("change",O=>{const k=O.target;f.setPlayingAreaVisible(k.checked);const P=document.getElementById("playing-area-offset");P&&(P.style.display=k.checked?"flex":"none"),te()}),b.appendChild(S),b.appendChild(_)}const w=document.getElementById("playing-area-offset");if(w){const S=document.createElement("label");S.textContent="Playing Area Offset: ";const _=document.createElement("button");_.textContent="−",_.className="offset-button",_.addEventListener("click",()=>{const P=f.getPlayingAreaOffset();f.setPlayingAreaOffset(P-1),O.textContent=String(P-1);const M=I.getCurrentPreset();if(M){const B=z(M.defaultLowestNote,M.rows,M.cols);f.highlightPlayingArea(B)}});const O=document.createElement("span");O.textContent="0",O.className="offset-display";const k=document.createElement("button");k.textContent="+",k.className="offset-button",k.addEventListener("click",()=>{const P=f.getPlayingAreaOffset();f.setPlayingAreaOffset(P+1),O.textContent=String(P+1);const M=I.getCurrentPreset();if(M){const B=z(M.defaultLowestNote,M.rows,M.cols);f.highlightPlayingArea(B)}}),w.appendChild(S),w.appendChild(_),w.appendChild(O),w.appendChild(k),w.style.display="none"}const I=new Nn("preset-selector",ne,S=>{f.stopAll();const _=document.getElementById("lowest-note-select");_&&(_.value=S.defaultLowestNote),f.render(S),te()});E.setPresetSelector(I),I.render();const N=br(window.location.hash);if(N){console.log("Restoring settings from URL hash:",N);const S=Ar(N.instrumentIndex);if(S){const ue=[{value:"electric_piano_1",name:"Electric Piano (Rhodes)"},{value:"electric_piano_2",name:"Electric Piano (DX7)"},{value:"acoustic_grand_piano",name:"Acoustic Grand Piano"},{value:"bright_acoustic_piano",name:"Bright Acoustic Piano"},{value:"electric_grand_piano",name:"Electric Grand Piano"},{value:"honky_tonk_piano",name:"Honky-Tonk Piano"},{value:"vibraphone",name:"Vibraphone"},{value:"marimba",name:"Marimba"},{value:"xylophone",name:"Xylophone"},{value:"harpsichord",name:"Harpsichord"},{value:"clavinet",name:"Clavinet"},{value:"drawbar_organ",name:"Drawbar Organ"},{value:"percussive_organ",name:"Percussive Organ"},{value:"rock_organ",name:"Rock Organ"},{value:"church_organ",name:"Church Organ"},{value:"reed_organ",name:"Reed Organ"},{value:"acoustic_guitar_nylon",name:"Acoustic Guitar (Nylon)"},{value:"acoustic_guitar_steel",name:"Acoustic Guitar (Steel)"},{value:"electric_guitar_jazz",name:"Electric Guitar (Jazz)"},{value:"electric_guitar_clean",name:"Electric Guitar (Clean)"},{value:"electric_guitar_muted",name:"Electric Guitar (Muted)"},{value:"overdriven_guitar",name:"Overdriven Guitar"},{value:"distortion_guitar",name:"Distortion Guitar"},{value:"acoustic_bass",name:"Acoustic Bass"},{value:"electric_bass_finger",name:"Electric Bass (Finger)"},{value:"electric_bass_pick",name:"Electric Bass (Pick)"},{value:"fretless_bass",name:"Fretless Bass"}].find(U=>U.value===S);ue&&(window.updateInstrumentButton&&window.updateInstrumentButton(S,ue.name),H.changeInstrument(S).catch(U=>{console.error("Failed to restore instrument:",U)}))}const _=document.getElementById("lowest-note-select"),O=Er(N.lowestNoteIndex);_&&O&&(_.value=O,ne.updateLowestNote(O));const k=_r(N.presetIndex);k&&I.selectPreset(k);const P=document.getElementById("show-labels");P&&(P.checked=N.showLabels,f.setShowLabels(N.showLabels));const M=document.getElementById("show-playing-area");if(M){M.checked=N.showPlayingArea,f.setPlayingAreaVisible(N.showPlayingArea);const j=document.getElementById("playing-area-offset");j&&(j.style.display=N.showPlayingArea?"flex":"none")}const B=document.getElementById("highlight-mode-select");B&&(B.value=N.highlightMode,ne.updateHighlightMode(N.highlightMode))}const F=I.getCurrentPreset();if(F){const S=document.getElementById("lowest-note-select");S&&!N&&(S.value=F.defaultLowestNote),f.render(F)}if(F){const S=z(F.defaultLowestNote,F.rows,F.cols);f.highlightPlayingArea(S),console.log("Playing area highlighted:",S)}te(),console.log("Music Touchpad initialized successfully!");const Z=new URLSearchParams(window.location.search).get("lesson");Z?(console.log(`Lesson parameter detected: ${Z}`),await kr(f,F,Z)):console.log("No lesson parameter - running in free-play mode")}catch(g){console.error("Failed to initialize app:",g);const f=document.createElement("div");f.className="error-message",f.textContent="Failed to load audio. Please refresh the page.",e.appendChild(f)}}async function Mr(e,t,n){try{console.log(`Loading new lesson: ${n}`),await E.stopAndClearLearningMode(),e.stopAll();const r=n.endsWith(".yaml")?n:`${n}.yaml`,o=await fetch(`/music-touchpad/lessons/${r}?t=${Date.now()}`);if(!o.ok)throw new Error(`Failed to load lesson "${r}": ${o.statusText}`);const i=await o.text();console.log("New lesson YAML loaded from file");const s=new We(i);E.setLesson(s,n);const l=s.getLowestNote();console.log("Using lowest note:",l,"(from lesson config)");const a=document.getElementById("lowest-note-select");a&&(a.value=l),ne.updateLowestNote(l);const d=E.getPresetSelector()?.getCurrentPreset();if(!d)throw new Error("Failed to get updated preset after setting lowest note");e.stopAll(),e.render(d),console.log("Grid re-rendered with lowest note:",l);const u=z(l,d.rows,d.cols);e.highlightPlayingArea(u);const p=s.toLessonData(u,l,t.rows,t.cols);console.log("New lesson parsed"),E.setLessonData(p),be();const{LearningModeService:h}=await fe(async()=>{const{LearningModeService:v}=await import("./learningModeService-vdripZVb.js");return{LearningModeService:v}},[]),g=H.getAudioContext(),f=new h(e,p.tempo,u,g||void 0);E.setLearningMode(f),e.setOnNoteStartCallback((v,y)=>{E.getLearningMode()?.handleNoteInput(v,y)}),f.loadLesson(p.notes),f.start();const m=document.getElementById("metronome-toggle");m&&m.classList.add("visible"),console.log("New lesson loaded successfully!")}catch(r){console.error("Failed to load new lesson:",r)}}async function Tr(){if(!E.hasActiveLesson()){console.log("No active lesson to reload");return}const e=E.getGrid(),t=E.getPresetSelector(),n=E.getLessonName();if(!e||!t||!n){console.error("Required app state missing for reload");return}const r=t.getCurrentPreset();if(!r){console.error("No current preset");return}try{console.log(`Reloading lesson from file: ${n}`),await E.stopAndClearLearningMode(),e.stopAll();const o=n.endsWith(".yaml")?n:`${n}.yaml`,i=await fetch(`/music-touchpad/lessons/${o}?t=${Date.now()}`);if(!i.ok)throw new Error(`Failed to load lesson "${o}": ${i.statusText}`);const s=await i.text();console.log("YAML reloaded from file");const l=new We(s);E.setLesson(l,n);const c=document.getElementById("lowest-note-select")?.value||r.defaultLowestNote,d=z(c,r.rows,r.cols),u=l.toLessonData(d,c,r.rows,r.cols);console.log("Lesson re-parsed from fresh YAML"),E.setLessonData(u),be();const{LearningModeService:p}=await fe(async()=>{const{LearningModeService:m}=await import("./learningModeService-vdripZVb.js");return{LearningModeService:m}},[]),h=H.getAudioContext(),g=new p(e,u.tempo,d,h||void 0);E.setLearningMode(g),e.setOnNoteStartCallback((m,v)=>{E.getLearningMode()?.handleNoteInput(m,v)}),g.loadLesson(u.notes),g.start();const f=document.getElementById("metronome-toggle");f&&f.classList.add("visible"),console.log("Lesson reloaded successfully from file!")}catch(o){console.error("Failed to reload lesson:",o)}}async function Pr(){if(!E.hasActiveLesson()){console.log("No active lesson to reload");return}const e=E.getPresetSelector(),t=E.getGrid(),n=E.getLesson(),r=E.getLessonName();if(!e||!t||!n||!r){console.error("Required app state missing for reload");return}const o=e.getCurrentPreset();if(!o){console.error("No current preset");return}try{console.log(`Reloading learning mode with lesson: ${r}`),await E.stopAndClearLearningMode(),t.stopAll(),t.render(o);const s=document.getElementById("lowest-note-select")?.value||o.defaultLowestNote,l=z(s,o.rows,o.cols);console.log("New playing area:",l),t.highlightPlayingArea(l);const a=n.toLessonData(l,s,o.rows,o.cols);console.log("Lesson re-parsed with new playing area"),E.setLessonData(a),be();const{LearningModeService:c}=await fe(async()=>{const{LearningModeService:p}=await import("./learningModeService-vdripZVb.js");return{LearningModeService:p}},[]),d=H.getAudioContext(),u=new c(t,a.tempo,l,d||void 0);E.setLearningMode(u),t.setOnNoteStartCallback((p,h)=>{E.getLearningMode()?.handleNoteInput(p,h)}),u.loadLesson(a.notes),u.start(),console.log("Learning mode reloaded successfully!")}catch(i){console.error("Failed to reload learning mode:",i)}}async function kr(e,t,n){try{console.log(`Loading learning mode with lesson: ${n}`);const r=n.endsWith(".yaml")?n:`${n}.yaml`,o=await fetch(`/music-touchpad/lessons/${r}?t=${Date.now()}`);if(!o.ok)throw new Error(`Failed to load lesson "${r}": ${o.statusText}`);const i=await o.text();console.log("Raw YAML content (first 500 chars):",i.substring(0,500));const s=new We(i);E.setLesson(s,n);const l=s.getLowestNote();console.log("Using lowest note:",l,"(from lesson config)");const a=document.getElementById("lowest-note-select");a&&(a.value=l),ne.updateLowestNote(l);const d=E.getPresetSelector()?.getCurrentPreset();if(!d)throw new Error("Failed to get updated preset after setting lowest note");e.stopAll(),e.render(d),console.log("Grid re-rendered with lowest note:",l);const u=z(l,d.rows,d.cols);console.log("Playing area:",u),e.highlightPlayingArea(u);const p=s.toLessonData(u,l,t.rows,t.cols);console.log("Lesson parsed:",p),console.log("Scheduled notes:",p.notes.map(v=>v.isRest?`Rest at beat ${v.startBeat}, duration ${v.duration} (clef: ${v.clef||"treble"})`:v.isChord?`Chord at beat ${v.startBeat}: [${v.notes.map(y=>`${y.note} (MIDI ${y.midiNote}) at row=${y.position.row}, col=${y.position.col}`).join(", ")}]`:`${v.notes[0].note} (MIDI ${v.notes[0].midiNote}) at beat ${v.startBeat}, row=${v.notes[0].position.row}, col=${v.notes[0].position.col}`)),E.setLessonData(p),be();const{LearningModeService:h}=await fe(async()=>{const{LearningModeService:v}=await import("./learningModeService-vdripZVb.js");return{LearningModeService:v}},[]),g=H.getAudioContext(),f=new h(e,p.tempo,u,g||void 0);E.setLearningMode(f),e.setOnNoteStartCallback((v,y)=>{E.getLearningMode()?.handleNoteInput(v,y)}),f.loadLesson(p.notes),f.start();const m=document.getElementById("metronome-toggle");m&&m.classList.add("visible"),console.log("Learning mode started with wait mode and metronome enabled!")}catch(r){console.error("Failed to initialize learning mode:",r);const o=document.getElementById("app");if(o){const i=document.createElement("div");i.className="error-message",i.style.cssText="padding: 20px; margin: 20px; background: #fee; border: 2px solid #c00; border-radius: 8px; color: #c00;",i.innerHTML=`
        <strong>Failed to load lesson</strong><br>
        ${r instanceof Error?r.message:String(r)}<br>
        <small>Available lessons: ${$t.map(s=>s.value).join(", ")}</small>
      `,o.insertBefore(i,o.firstChild)}}}function be(){const e=document.getElementById("sheet-music-button"),t=document.getElementById("lesson-selector");if(!e){console.warn("Sheet music button not found");return}if(e.style.display="flex",t&&t.options.length===1&&$t.forEach(n=>{const r=document.createElement("option");r.value=n.value,r.textContent=n.name,t.appendChild(r)}),t){const n=E.getLessonName();n&&(t.value=n)}}async function Or(e){const t=document.getElementById("sheet-music-content");if(!t){console.warn("Sheet music content element not found");return}t.innerHTML='<div style="padding: 2rem; text-align: center;">Loading sheet music...</div>';try{const{renderSheetMusic:n,formatLessonMetadata:r}=await fe(async()=>{const{renderSheetMusic:s,formatLessonMetadata:l}=await import("./notationService-D8FMxFTa.js");return{renderSheetMusic:s,formatLessonMetadata:l}},[]),o=r(e),i="vexflow-container";t.innerHTML=`
      ${o}
      <div id="${i}"></div>
    `,n(i,e),E.markSheetMusicRendered()}catch(n){console.error("Failed to render sheet music:",n),t.innerHTML=`
      <div style="padding: 1rem; margin-top: 1rem; background-color: #fee; border: 2px solid #c00; border-radius: 8px; color: #c00;">
        <p style="font-weight: bold; margin-bottom: 0.5rem;">Failed to render sheet music</p>
        <p style="font-size: 0.9rem;">${n instanceof Error?n.message:String(n)}</p>
      </div>
    `}}Ir();export{Dr as l};
