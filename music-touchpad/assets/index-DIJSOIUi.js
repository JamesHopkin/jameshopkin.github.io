(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const u of e)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const u={};return e.integrity&&(u.integrity=e.integrity),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?u.credentials="include":e.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(e){if(e.ep)return;e.ep=!0;const u=n(e);fetch(e.href,u)}})();function pe(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function ge(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var t=a.default;if(typeof t=="function"){var n=function o(){var e=!1;try{e=this instanceof o}catch{}return e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(a).forEach(function(o){var e=Object.getOwnPropertyDescriptor(a,o);Object.defineProperty(n,o,e.get?e:{enumerable:!0,get:function(){return a[o]}})}),n}var q={exports:{}},O={exports:{}},B,K;function ye(){if(K)return B;K=1;function a(n){return n>64&&n<91?n-65:n>96&&n<123?n-71:n>47&&n<58?n+4:n===43?62:n===47?63:0}function t(n,o){for(var e=n.replace(/[^A-Za-z0-9\+\/]/g,""),u=e.length,l=o?Math.ceil((u*3+1>>2)/o)*o:u*3+1>>2,r=new Uint8Array(l),i,s,d=0,c=0,m=0;m<u;m++)if(s=m&3,d|=a(e.charCodeAt(m))<<18-6*s,s===3||u-m===1){for(i=0;i<3&&c<l;i++,c++)r[c]=d>>>(16>>>i&24)&255;d=0}return r}return B={decode:t},B}var F,W;function be(){return W||(W=1,F=function(a,t){return new Promise(function(n,o){var e=new XMLHttpRequest;t&&(e.responseType=t),e.open("GET",a),e.onload=function(){e.status===200?n(e.response):o(Error(e.statusText))},e.onerror=function(){o(Error("Network Error"))},e.send()})}),F}var Y;function Te(){return Y||(Y=1,(function(a){var t=ye(),n=be();function o(h){return function(f){return typeof f=="string"&&h.test(f)}}function e(h,f){return typeof h=="string"?h+f:typeof h=="function"?h(f):f}function u(h,f,T,A){var x=l(f)?r:i(f)?s:d(f)?c:m(f)?g:w(f)?b:v(f)?P:L(f)?E:p(f)?M:null,N=T||{};return x?x(h,f,N):A?Promise.resolve(A):Promise.reject("Source not valid ("+f+")")}u.fetch=n;function l(h){return h instanceof ArrayBuffer}function r(h,f,T){return new Promise(function(A,x){h.decodeAudioData(f,function(N){A(N)},function(){x("Can't decode audio data ("+f.slice(0,30)+"...)")})})}var i=o(/\.(mp3|wav|ogg)(\?.*)?$/i);function s(h,f,T){var A=e(T.from,f);return u(h,u.fetch(A,"arraybuffer"),T)}function d(h){return h&&typeof h.then=="function"}function c(h,f,T){return f.then(function(A){return u(h,A,T)})}var m=Array.isArray;function g(h,f,T){return Promise.all(f.map(function(A){return u(h,A,T,A)}))}function w(h){return h&&typeof h=="object"}function b(h,f,T){var A={},x=Object.keys(f).map(function(N){if(T.only&&T.only.indexOf(N)===-1)return null;var J=f[N];return u(h,J,T,J).then(function(ve){A[N]=ve})});return Promise.all(x).then(function(){return A})}var v=o(/\.json(\?.*)?$/i);function P(h,f,T){var A=e(T.from,f);return u(h,u.fetch(A,"text").then(JSON.parse),T)}var L=o(/^data:audio/);function E(h,f,T){var A=f.indexOf(",");return u(h,t.decode(f.slice(A+1)).buffer,T)}var p=o(/\.js(\?.*)?$/i);function M(h,f,T){var A=e(T.from,f);return u(h,u.fetch(A,"text").then(y),T)}function y(h){var f=h.indexOf("MIDI.Soundfont.");if(f<0)throw Error("Invalid MIDI.js Soundfont format");f=h.indexOf("=",f)+2;var T=h.lastIndexOf(",");return JSON.parse(h.slice(f,T)+"}")}a.exports&&(a.exports=u),typeof window<"u"&&(window.loadAudio=u)})(O)),O.exports}var R={exports:{}},D,Z;function we(){if(Z)return D;Z=1,D=a;function a(r){var i=r.createGain(),s=i._voltage=o(r),d=e(s),c=e(s),m=e(s);return i._startAmount=e(c),i._endAmount=e(m),i._multiplier=e(d),i._multiplier.connect(i),i._startAmount.connect(i),i._endAmount.connect(i),i.value=d.gain,i.startValue=c.gain,i.endValue=m.gain,i.startValue.value=0,i.endValue.value=0,Object.defineProperties(i,t),i}var t={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(r){var i=this._multiplier.gain,s=this._startAmount.gain,d=this._endAmount.gain;this._voltage.start(r),this._decayFrom=this._decayFrom=r+this.attack,this._startedAt=r;var c=this.sustain;i.cancelScheduledValues(r),s.cancelScheduledValues(r),d.cancelScheduledValues(r),d.setValueAtTime(0,r),this.attack?(i.setValueAtTime(0,r),i.linearRampToValueAtTime(1,r+this.attack),s.setValueAtTime(1,r),s.linearRampToValueAtTime(0,r+this.attack)):(i.setValueAtTime(1,r),s.setValueAtTime(0,r)),this.decay&&i.setTargetAtTime(c,this._decayFrom,u(this.decay))}},stop:{value:function(r,i){i&&(r=r-this.release);var s=r+this.release;if(this.release){var d=this._multiplier.gain,c=this._startAmount.gain,m=this._endAmount.gain;d.cancelScheduledValues(r),c.cancelScheduledValues(r),m.cancelScheduledValues(r);var g=u(this.release);if(this.attack&&r<this._decayFrom){var w=l(0,1,this._startedAt,this._decayFrom,r);d.linearRampToValueAtTime(w,r),c.linearRampToValueAtTime(1-w,r),c.setTargetAtTime(0,r,g)}m.setTargetAtTime(1,r,g),d.setTargetAtTime(0,r,g)}return this._voltage.stop(s),s}},onended:{get:function(){return this._voltage.onended},set:function(r){this._voltage.onended=r}}},n=new Float32Array([1,1]);function o(r){var i=r.createBufferSource(),s=r.createBuffer(1,2,r.sampleRate);return s.getChannelData(0).set(n),i.buffer=s,i.loop=!0,i}function e(r){var i=r.context.createGain();return r.connect(i),i}function u(r){return Math.log(r+1)/Math.log(100)}function l(r,i,s,d,c){var m=i-r,g=d-s,w=c-s,b=w/g,v=r+b*m;return v<=r&&(v=r),v>=i&&(v=i),v}return D}var j,Q;function Ee(){if(Q)return j;Q=1;var a=we(),t={},n={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function o(i,s,d){var c=!1,m=0,g={},w=i.createGain();w.gain.value=1;var b=Object.assign({},n,d),v={context:i,out:w,opts:b};return s instanceof AudioBuffer?v.buffer=s:v.buffers=s,v.start=function(E,p,M){if(v.buffer&&E!==null)return v.start(null,E,p);var y=E?v.buffers[E]:v.buffer;if(y){if(!c){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+E+" not found.");return}var h=M||t;p=Math.max(i.currentTime,p||0),v.emit("start",p,E,h);var f=L(E,y,h);return f.id=P(E,f),f.env.start(p),f.source.start(p),v.emit("started",p,f.id,f),h.duration&&f.stop(p+h.duration),f},v.play=function(E,p,M){return v.start(E,p,M)},v.stop=function(E,p){var M;return p=p||Object.keys(g),p.map(function(y){return M=g[y],M?(M.stop(E),M.id):null})},v.connect=function(E){return c=!0,w.connect(E),v},v.emit=function(E,p,M,y){v.onevent&&v.onevent(E,p,M,y);var h=v["on"+E];h&&h(p,M,y)},v;function P(E,p){return p.id=m++,g[p.id]=p,p.source.onended=function(){var M=i.currentTime;p.source.disconnect(),p.env.disconnect(),p.disconnect(),v.emit("ended",M,p.id,p)},p.id}function L(E,p,M){var y=i.createGain();return y.gain.value=0,y.connect(w),y.env=l(i,M,b),y.env.connect(y.gain),y.source=i.createBufferSource(),y.source.buffer=p,y.source.connect(y),y.source.loop=M.loop||b.loop,y.source.playbackRate.value=r(M.cents||b.cents),y.source.loopStart=M.loopStart||b.loopStart,y.source.loopEnd=M.loopEnd||b.loopEnd,y.stop=function(h){var f=h||i.currentTime;v.emit("stop",f,E);var T=y.env.stop(f);y.source.stop(T)},y}}function e(i){return typeof i=="number"}var u=["attack","decay","sustain","release"];function l(i,s,d){var c=a(i),m=s.adsr||d.adsr;return u.forEach(function(g,w){m?c[g]=m[w]:c[g]=s[g]||d[g]}),c.value.value=e(s.gain)?s.gain:e(d.gain)?d.gain:1,c}function r(i){return i?Math.pow(2,i/1200):1}return j=o,j}var k,ee;function Me(){if(ee)return k;ee=1,k=function(t){return t.on=function(n,o){if(arguments.length===1&&typeof n=="function")return t.on("event",n);var e="on"+n,u=t[e];return t[e]=u?a(u,o):o,t},t};function a(t,n){return function(o,e,u,l){t(o,e,u,l),n(o,e,u,l)}}return k}var H,te;function Ae(){if(te)return H;te=1;var a=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function t(){return a}var n=[0,2,4,5,7,9,11];function o(r,i,s){if(typeof r!="string")return null;var d=a.exec(r);if(!d||!i&&d[4])return null;var c={letter:d[1].toUpperCase(),acc:d[2].replace(/x/g,"##")};return c.pc=c.letter+c.acc,c.step=(c.letter.charCodeAt(0)+3)%7,c.alt=c.acc[0]==="b"?-c.acc.length:c.acc.length,c.chroma=n[c.step]+c.alt,d[3]&&(c.oct=+d[3],c.midi=c.chroma+12*(c.oct+1),c.freq=e(c.midi,s)),i&&(c.tonicOf=d[4]),c}function e(r,i){return Math.pow(2,(r-69)/12)*(i||440)}var u={parse:o,regex:t,midiToFreq:e},l=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];return l.forEach(function(r){u[r]=function(i){var s=o(i);return s&&typeof s[r]<"u"?s[r]:null}}),H=u,H}var I,ne;function _e(){if(ne)return I;ne=1;var a=Ae(),t=function(e){return e!==null&&e!==[]&&e>=0&&e<129},n=function(e){return t(e)?+e:a.midi(e)};I=function(e){if(e.buffers){var u=e.opts.map,l=typeof u=="function"?u:n,r=function(s){return s?l(s)||s:null};e.buffers=o(e.buffers,r);var i=e.start;e.start=function(s,d,c){var m=r(s),g=m%1;return g&&(m=Math.floor(m),c=Object.assign(c||{},{cents:Math.floor(g*100)})),i(m,d,c)}}return e};function o(e,u){return Object.keys(e).reduce(function(l,r){return l[u(r)]=e[r],l},{})}return I}var $,re;function Ne(){if(re)return $;re=1;var a=Array.isArray,t=function(o){return o&&typeof o=="object"},n={};return $=function(o){return o.schedule=function(e,u){var l=o.context.currentTime,r=e<l?l:e;o.emit("schedule",r,u);var i,s,d,c;return u.map(function(m){if(m)a(m)?(i=m[0],s=m[1]):(i=m.time,s=m);else return null;return t(s)?(d=s.name||s.key||s.note||s.midi||null,c=s):(d=s,c=n),o.start(d,r+(i||0),c)})},o},$}function C(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var G={exports:{}},oe;function Se(){return oe||(oe=1,(function(a,t){(function(n){a.exports=n()})(function(){return(function n(o,e,u){function l(s,d){if(!e[s]){if(!o[s]){var c=typeof C=="function"&&C;if(!d&&c)return c(s,!0);if(r)return r(s,!0);var m=new Error("Cannot find module '"+s+"'");throw m.code="MODULE_NOT_FOUND",m}var g=e[s]={exports:{}};o[s][0].call(g.exports,function(w){var b=o[s][1][w];return l(b||w)},g,g.exports,n,o,e,u)}return e[s].exports}for(var r=typeof C=="function"&&C,i=0;i<u.length;i++)l(u[i]);return l})({1:[function(n,o,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(u){function l(r){if(this._event=r,this._data=r.data,this.receivedTime=r.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=r.data[0]&240,this.channel=r.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=r.data[1]&127,this.velocity=r.data[2]&127;break;case 144:this.messageType="noteon",this.key=r.data[1]&127,this.velocity=r.data[2]&127;break;case 160:this.messageType="keypressure",this.key=r.data[1]&127,this.pressure=r.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=r.data[1]&127,this.controllerValue=r.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=r.data[1];break;case 208:this.messageType="channelpressure",this.pressure=r.data[1]&127;break;case 224:this.messageType="pitchbendchange";var i=r.data[2]&127,s=r.data[1]&127;this.pitchBend=(i<<8)+s;break}}return new l(u)},o.exports=e.default},{}]},{},[1])(1)})})(G)),G.exports}var V,ie;function xe(){if(ie)return V;ie=1;var a=Se();return V=function(t){return t.listenToMidi=function(n,o){var e={},u=o||{},l=u.gain||function(r){return r/127};return n.onmidimessage=function(r){var i=r.messageType?r:a(r);if(i.messageType==="noteon"&&i.velocity===0&&(i.messageType="noteoff"),!(u.channel&&i.channel!==u.channel))switch(i.messageType){case"noteon":e[i.key]=t.play(i.key,0,{gain:l(i.velocity)});break;case"noteoff":e[i.key]&&(e[i.key].stop(),delete e[i.key]);break}},t},t},V}var ae;function Ce(){return ae||(ae=1,(function(a){var t=Ee(),n=Me(),o=_e(),e=Ne(),u=xe();function l(r,i,s){return u(e(o(n(t(r,i,s)))))}a.exports&&(a.exports=l),typeof window<"u"&&(window.SamplePlayer=l)})(R)),R.exports}function se(a,t){return Array(t+1).join(a)}function X(a){return typeof a=="number"}function Pe(a){return typeof a=="string"}function Le(a){return typeof a<"u"}function de(a,t){return Math.pow(2,(a-69)/12)*(t||440)}var fe=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function qe(){return fe}var Oe=[0,2,4,5,7,9,11];function _(a,t,n){if(typeof a!="string")return null;var o=fe.exec(a);if(!o||!t&&o[4])return null;var e={letter:o[1].toUpperCase(),acc:o[2].replace(/x/g,"##")};e.pc=e.letter+e.acc,e.step=(e.letter.charCodeAt(0)+3)%7,e.alt=e.acc[0]==="b"?-e.acc.length:e.acc.length;var u=Oe[e.step]+e.alt;return e.chroma=u<0?12+u:u%12,o[3]&&(e.oct=+o[3],e.midi=u+12*(e.oct+1),e.freq=de(e.midi,n)),t&&(e.tonicOf=o[4]),e}var Be="CDEFGAB";function Fe(a){return X(a)?a<0?se("b",-a):se("#",a):""}function Re(a){return X(a)?""+a:""}function he(a,t,n){return a===null||typeof a>"u"?null:a.step?he(a.step,a.alt,a.oct):a<0||a>6?null:Be.charAt(a)+Fe(t)+Re(n)}function me(a){if((X(a)||Pe(a))&&a>=0&&a<128)return+a;var t=_(a);return t&&Le(t.midi)?t.midi:null}function De(a,t){var n=me(a);return n===null?null:de(n,t)}function je(a){return(_(a)||{}).letter}function ke(a){return(_(a)||{}).acc}function He(a){return(_(a)||{}).pc}function Ie(a){return(_(a)||{}).step}function $e(a){return(_(a)||{}).alt}function Ge(a){return(_(a)||{}).chroma}function Ve(a){return(_(a)||{}).oct}const Ue=Object.freeze(Object.defineProperty({__proto__:null,acc:ke,alt:$e,build:he,chroma:Ge,freq:De,letter:je,midi:me,oct:Ve,parse:_,pc:He,regex:qe,step:Ie},Symbol.toStringTag,{value:"Module"})),Xe=ge(Ue);var U,ue;function ze(){if(ue)return U;ue=1;var a=Xe;function t(e,u){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof t))return new t(e);this.nameToUrl=u||t.nameToUrl,this.ctx=e,this.instruments={},this.promises=[]}t.prototype.onready=function(e){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(e)},t.prototype.instrument=function(e,u){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var l=this.ctx;if(e=e||"default",e in this.instruments)return this.instruments[e];var r={name:e,play:o(l,u)};if(this.instruments[e]=r,e!=="default"){var i=t.instrument(l,e,u).then(function(s){return r.play=s.play,r});this.promises.push(i),r.onready=function(s){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),i.then(s)}}else r.onready=function(s){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),s()};return r};function n(e,u,l){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),t.instrument(e,u,l).then(function(r){return r.buffers})}t.loadBuffers=n;function o(e,u){return u=u||{},function(l,r,i,s){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var d=l>0&&l<129?+l:a.midi(l),c=d?a.midiToFreq(d,440):null;if(c){i=i||.2,s=s||{};var m=s.destination||u.destination||e.destination,g=s.vcoType||u.vcoType||"sine",w=s.gain||u.gain||.4,b=e.createOscillator();b.type=g,b.frequency.value=c;var v=e.createGain();return v.gain.value=w,b.connect(v),v.connect(m),b.start(r),i>0&&b.stop(r+i),b}}}return t.noteToMidi=a.midi,U=t,U}var ce;function Je(){return ce||(ce=1,(function(a){var t=Te(),n=Ce();function o(r,i,s){if(arguments.length===1)return function(w,b){return o(r,w,b)};var d=s||{},c=d.isSoundfontURL||e,m=d.nameToUrl||u,g=c(i)?i:m(i,d.soundfont,d.format);return t(r,g,{only:d.only||d.notes}).then(function(w){var b=n(r,w,d).connect(d.destination?d.destination:r.destination);return b.url=g,b.name=i,b})}function e(r){return/\.js(\?.*)?$/i.test(r)}function u(r,i,s){return s=s==="ogg"?s:"mp3",i=i==="FluidR3_GM"?i:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+i+"/"+r+"-"+s+".js"}var l=ze();l.instrument=o,l.nameToUrl=u,a.exports&&(a.exports=l),typeof window<"u"&&(window.Soundfont=l)})(q)),q.exports}var Ke=Je();const le=pe(Ke);class We{instrument=null;activeNotes=new Map;ready=!1;audioContext=null;async initialize(t="electric_piano_1"){try{this.audioContext=new AudioContext,this.instrument=await le.instrument(this.audioContext,t,{format:"mp3",soundfont:"MusyngKite"}),this.ready=!0,console.log(`Audio service initialized with ${t}`)}catch(n){throw console.error("Failed to initialize audio service:",n),n}}async changeInstrument(t){try{this.stopAllNotes(),this.ready=!1,this.audioContext||(this.audioContext=new AudioContext),this.instrument=await le.instrument(this.audioContext,t,{format:"mp3",soundfont:"MusyngKite"}),this.ready=!0,console.log(`Changed instrument to ${t}`)}catch(n){throw console.error("Failed to change instrument:",n),n}}playNote(t){if(!this.instrument||!this.ready){console.warn("Audio service not ready");return}if(this.activeNotes.has(t))return;const n=this.instrument.play(t);this.activeNotes.set(t,n)}stopNote(t){const n=this.activeNotes.get(t);n&&(n.stop(),this.activeNotes.delete(t))}stopAllNotes(){this.activeNotes.forEach(t=>t.stop()),this.activeNotes.clear()}isReady(){return this.ready}setPitchBend(t,n){const o=this.activeNotes.get(t);if(o)try{o.source&&o.source.detune&&(o.source.detune.value=n)}catch(e){console.warn("Failed to apply pitch bend:",e)}}}const S=new We;class Ye{container;activeButtons=new Set;showLabels=!0;currentPreset=null;dragStartX=new Map;noteToTouchId=new Map;touchIdToNote=new Map;documentMouseMoveHandler=null;documentMouseUpHandler=null;documentTouchMoveHandler=null;documentTouchEndHandler=null;documentTouchCancelHandler=null;constructor(t){const n=document.getElementById(t);if(!n)throw new Error(`Container element with id "${t}" not found`);this.container=n,this.setupDocumentEventListeners()}isFormControl(t){if(!t||!(t instanceof HTMLElement))return!1;const n=t.tagName.toLowerCase();return n==="select"||n==="input"||n==="textarea"||n==="label"||t.closest("select, input, textarea, label")!==null}setupDocumentEventListeners(){this.documentMouseMoveHandler=t=>{t.preventDefault(),this.activeButtons.forEach(n=>{this.noteToTouchId.has(n)||this.handleDrag(n,t.clientX)})},this.documentMouseUpHandler=t=>{t.preventDefault(),this.activeButtons.forEach(n=>{this.noteToTouchId.has(n)||this.handleNoteEnd(n)})},this.documentTouchMoveHandler=t=>{this.isFormControl(t.target)||t.preventDefault();for(let n=0;n<t.touches.length;n++){const o=t.touches[n],e=this.touchIdToNote.get(o.identifier);e&&this.activeButtons.has(e)&&this.handleDrag(e,o.clientX,o.identifier)}},this.documentTouchEndHandler=t=>{this.isFormControl(t.target)||t.preventDefault();for(let n=0;n<t.changedTouches.length;n++){const o=t.changedTouches[n],e=this.touchIdToNote.get(o.identifier);e&&this.handleNoteEnd(e,o.identifier)}},this.documentTouchCancelHandler=t=>{this.isFormControl(t.target)||t.preventDefault();for(let n=0;n<t.changedTouches.length;n++){const o=t.changedTouches[n],e=this.touchIdToNote.get(o.identifier);e&&this.handleNoteEnd(e,o.identifier)}},document.addEventListener("mousemove",this.documentMouseMoveHandler),document.addEventListener("mouseup",this.documentMouseUpHandler),document.addEventListener("touchmove",this.documentTouchMoveHandler,{passive:!1}),document.addEventListener("touchend",this.documentTouchEndHandler,{passive:!1}),document.addEventListener("touchcancel",this.documentTouchCancelHandler,{passive:!1})}setShowLabels(t){this.showLabels=t,this.currentPreset&&this.render(this.currentPreset)}render(t){this.currentPreset=t,this.activeButtons.clear(),this.container.innerHTML="",this.container.style.display="grid",this.container.style.gridTemplateRows=`repeat(${t.rows}, 1fr)`,this.container.style.gridTemplateColumns=`repeat(${t.cols}, 1fr)`;const n=t.rows>10||t.cols>10?"2px":"6px";this.container.style.gap=n,this.container.style.width="100%",this.container.style.height="100%";const o=t.rows>10||t.cols>10?"8px":"16px";this.container.style.padding=o,t.buttons.forEach(e=>{const u=this.createButton(e);this.container.appendChild(u)})}createButton(t){const n=document.createElement("button");return n.className="pad-button",n.textContent=this.showLabels?t.label||t.note:"",n.dataset.note=t.note,t.color&&(n.style.backgroundColor=t.color),n.style.gridRow=`${t.row+1}`,n.style.gridColumn=`${t.col+1}`,n.addEventListener("mousedown",o=>{o.preventDefault(),this.handleNoteStart(t.note,n,o.clientX)}),n.addEventListener("touchstart",o=>{if(o.preventDefault(),o.changedTouches.length>0){const e=o.changedTouches[0];this.handleNoteStart(t.note,n,e.clientX,e.identifier)}}),n}handleNoteStart(t,n,o,e){if(!S.isReady()){console.warn("Audio service not ready");return}this.activeButtons.has(t)||(this.activeButtons.add(t),n.classList.add("active"),S.playNote(t),this.dragStartX.set(t,o),e!==void 0&&(this.noteToTouchId.set(t,e),this.touchIdToNote.set(e,t)))}handleDrag(t,n,o){if(o!==void 0&&this.noteToTouchId.get(t)!==o)return;const e=this.dragStartX.get(t);if(e===void 0)return;const u=n-e,l=window.innerWidth,r=1200,i=u/l*r,s=Math.max(-r,Math.min(r,i));S.setPitchBend(t,s)}handleNoteEnd(t,n){n!==void 0&&this.noteToTouchId.get(t)!==n||this.activeButtons.has(t)&&(this.activeButtons.delete(t),this.container.querySelectorAll(`[data-note="${t}"]`).forEach(e=>{e.classList.remove("active")}),S.stopNote(t),this.dragStartX.delete(t),n!==void 0&&(this.noteToTouchId.delete(t),this.touchIdToNote.delete(n)))}stopAll(){this.activeButtons.clear(),S.stopAllNotes(),this.container.querySelectorAll(".pad-button").forEach(n=>n.classList.remove("active"))}destroy(){this.documentMouseMoveHandler&&document.removeEventListener("mousemove",this.documentMouseMoveHandler),this.documentMouseUpHandler&&document.removeEventListener("mouseup",this.documentMouseUpHandler),this.documentTouchMoveHandler&&document.removeEventListener("touchmove",this.documentTouchMoveHandler),this.documentTouchEndHandler&&document.removeEventListener("touchend",this.documentTouchEndHandler),this.documentTouchCancelHandler&&document.removeEventListener("touchcancel",this.documentTouchCancelHandler),this.stopAll()}}class Ze{container;config;onPresetChange;currentPresetId;constructor(t,n,o){const e=document.getElementById(t);if(!e)throw new Error(`Container element with id "${t}" not found`);this.container=e,this.config=n,this.onPresetChange=o,this.currentPresetId=n.defaultPresetId}render(){this.container.innerHTML="";const t=document.createElement("label");t.textContent="Layout: ",t.htmlFor="preset-select";const n=document.createElement("select");n.id="preset-select",n.className="preset-select",this.config.presets.forEach(o=>{const e=document.createElement("option");e.value=o.id,e.textContent=o.name,e.selected=o.id===this.currentPresetId,n.appendChild(e)}),n.addEventListener("change",o=>{const u=o.target.value;this.selectPreset(u)}),this.container.appendChild(t),this.container.appendChild(n)}selectPreset(t){const n=this.config.presets.find(o=>o.id===t);n?(this.currentPresetId=t,this.onPresetChange(n)):console.error(`Preset with id "${t}" not found`)}getCurrentPreset(){return this.config.presets.find(t=>t.id===this.currentPresetId)}}function z(a,t){const n=a.includes("#"),e={0:0,1:0,2:0,3:30,4:60,5:150,6:180,7:240,8:280,9:280}[t]??240;return n?`hsl(${e}, 25%, 28%)`:`hsl(${e}, 30%, 35%)`}function Qe(){const a=["C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5"],t=[];for(let n=0;n<a.length;n++){const o=Math.floor(n/6),e=n%6,u=a[n],l=parseInt(u.match(/\d+/)?.[0]??"4"),r=u.replace(/\d+/,"");t.push({row:o,col:e,note:u,label:u,color:z(r,l)})}return t}function et(){const a=[],n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let o=0;o<16;o++)for(let e=0;e<19;e++){const u=36+e*2+o,l=Math.floor(u/12)-1,r=u%12,i=n[r],s=`${i}${l}`,d=z(i,l);a.push({row:15-o,col:e,note:s,label:s,color:d})}return a}function tt(){const a=[],n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let o=0;o<12;o++)for(let e=0;e<15;e++){const u=48+e*2+o,l=Math.floor(u/12)-1,r=u%12,i=n[r],s=`${i}${l}`,d=z(i,l);a.push({row:11-o,col:e,note:s,label:s,color:d})}return a}const nt={presets:[{id:"chromatic",name:"Chromatic Scale",rows:4,cols:6,buttons:Qe()},{id:"harpejji",name:"Harpejji",rows:16,cols:19,buttons:et()},{id:"harpejji-compact",name:"Harpejji Compact",rows:12,cols:15,buttons:tt()}],defaultPresetId:"chromatic"};async function rt(){const a=document.getElementById("app");if(!a)throw new Error("App container not found");a.classList.add("loading");const t=document.getElementById("header");if(t){const n=document.createElement("div");n.id="loading-message",n.textContent="Loading audio...",t.appendChild(n)}try{await S.initialize("electric_piano_1");const n=document.getElementById("loading-message");n&&n.remove(),a.classList.remove("loading");const o=new Ye("grid-container"),e=document.getElementById("instrument-selector");if(e){const i=document.createElement("label");i.textContent="Instrument: ",i.htmlFor="instrument-select";const s=document.createElement("select");s.id="instrument-select",s.className="preset-select",[{value:"electric_piano_1",name:"Electric Piano (Rhodes)"},{value:"electric_piano_2",name:"Electric Piano (DX7)"},{value:"acoustic_grand_piano",name:"Acoustic Grand Piano"},{value:"bright_acoustic_piano",name:"Bright Acoustic Piano"},{value:"electric_grand_piano",name:"Electric Grand Piano"},{value:"honky_tonk_piano",name:"Honky-Tonk Piano"},{value:"vibraphone",name:"Vibraphone"},{value:"marimba",name:"Marimba"},{value:"xylophone",name:"Xylophone"},{value:"harpsichord",name:"Harpsichord"},{value:"clavinet",name:"Clavinet"},{value:"drawbar_organ",name:"Drawbar Organ"},{value:"percussive_organ",name:"Percussive Organ"},{value:"rock_organ",name:"Rock Organ"},{value:"church_organ",name:"Church Organ"},{value:"reed_organ",name:"Reed Organ"},{value:"acoustic_guitar_nylon",name:"Acoustic Guitar (Nylon)"},{value:"acoustic_guitar_steel",name:"Acoustic Guitar (Steel)"},{value:"electric_guitar_jazz",name:"Electric Guitar (Jazz)"},{value:"electric_guitar_clean",name:"Electric Guitar (Clean)"},{value:"electric_guitar_muted",name:"Electric Guitar (Muted)"},{value:"overdriven_guitar",name:"Overdriven Guitar"},{value:"distortion_guitar",name:"Distortion Guitar"}].forEach(c=>{const m=document.createElement("option");m.value=c.value,m.textContent=c.name,m.selected=c.value==="electric_piano_1",s.appendChild(m)}),s.addEventListener("change",async c=>{const g=c.target.value;s.disabled=!0,o.stopAll();try{await S.changeInstrument(g),s.disabled=!1}catch(w){console.error("Failed to change instrument:",w),s.disabled=!1}}),e.appendChild(i),e.appendChild(s)}const u=document.getElementById("labels-toggle");if(u){const i=document.createElement("input");i.type="checkbox",i.id="show-labels",i.checked=!0;const s=document.createElement("label");s.htmlFor="show-labels",s.textContent="Show note names",i.addEventListener("change",d=>{const c=d.target;o.setShowLabels(c.checked)}),u.appendChild(i),u.appendChild(s)}const l=new Ze("preset-selector",nt,i=>{o.stopAll(),o.render(i)});l.render();const r=l.getCurrentPreset();r&&o.render(r),console.log("Music Touchpad initialized successfully!")}catch(n){console.error("Failed to initialize app:",n);const o=document.createElement("div");o.className="error-message",o.textContent="Failed to load audio. Please refresh the page.",a.appendChild(o)}}rt();
