(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const u of e)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function r(e){const u={};return e.integrity&&(u.integrity=e.integrity),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?u.credentials="include":e.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(e){if(e.ep)return;e.ep=!0;const u=r(e);fetch(e.href,u)}})();function ve(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function me(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var t=i.default;if(typeof t=="function"){var r=function a(){var e=!1;try{e=this instanceof a}catch{}return e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(i).forEach(function(a){var e=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(r,a,e.get?e:{enumerable:!0,get:function(){return i[a]}})}),r}var L={exports:{}},R={exports:{}},B,X;function ge(){if(X)return B;X=1;function i(r){return r>64&&r<91?r-65:r>96&&r<123?r-71:r>47&&r<58?r+4:r===43?62:r===47?63:0}function t(r,a){for(var e=r.replace(/[^A-Za-z0-9\+\/]/g,""),u=e.length,d=a?Math.ceil((u*3+1>>2)/a)*a:u*3+1>>2,n=new Uint8Array(d),o,s,l=0,c=0,p=0;p<u;p++)if(s=p&3,l|=i(e.charCodeAt(p))<<18-6*s,s===3||u-p===1){for(o=0;o<3&&c<d;o++,c++)n[c]=l>>>(16>>>o&24)&255;l=0}return n}return B={decode:t},B}var O,K;function ye(){return K||(K=1,O=function(i,t){return new Promise(function(r,a){var e=new XMLHttpRequest;t&&(e.responseType=t),e.open("GET",i),e.onload=function(){e.status===200?r(e.response):a(Error(e.statusText))},e.onerror=function(){a(Error("Network Error"))},e.send()})}),O}var Y;function be(){return Y||(Y=1,(function(i){var t=ge(),r=ye();function a(h){return function(f){return typeof f=="string"&&h.test(f)}}function e(h,f){return typeof h=="string"?h+f:typeof h=="function"?h(f):f}function u(h,f,w,S){var x=d(f)?n:o(f)?s:l(f)?c:p(f)?g:A(f)?b:v(f)?C:q(f)?E:m(f)?T:null,_=w||{};return x?x(h,f,_):S?Promise.resolve(S):Promise.reject("Source not valid ("+f+")")}u.fetch=r;function d(h){return h instanceof ArrayBuffer}function n(h,f,w){return new Promise(function(S,x){h.decodeAudioData(f,function(_){S(_)},function(){x("Can't decode audio data ("+f.slice(0,30)+"...)")})})}var o=a(/\.(mp3|wav|ogg)(\?.*)?$/i);function s(h,f,w){var S=e(w.from,f);return u(h,u.fetch(S,"arraybuffer"),w)}function l(h){return h&&typeof h.then=="function"}function c(h,f,w){return f.then(function(S){return u(h,S,w)})}var p=Array.isArray;function g(h,f,w){return Promise.all(f.map(function(S){return u(h,S,w,S)}))}function A(h){return h&&typeof h=="object"}function b(h,f,w){var S={},x=Object.keys(f).map(function(_){if(w.only&&w.only.indexOf(_)===-1)return null;var H=f[_];return u(h,H,w,H).then(function(pe){S[_]=pe})});return Promise.all(x).then(function(){return S})}var v=a(/\.json(\?.*)?$/i);function C(h,f,w){var S=e(w.from,f);return u(h,u.fetch(S,"text").then(JSON.parse),w)}var q=a(/^data:audio/);function E(h,f,w){var S=f.indexOf(",");return u(h,t.decode(f.slice(S+1)).buffer,w)}var m=a(/\.js(\?.*)?$/i);function T(h,f,w){var S=e(w.from,f);return u(h,u.fetch(S,"text").then(y),w)}function y(h){var f=h.indexOf("MIDI.Soundfont.");if(f<0)throw Error("Invalid MIDI.js Soundfont format");f=h.indexOf("=",f)+2;var w=h.lastIndexOf(",");return JSON.parse(h.slice(f,w)+"}")}i.exports&&(i.exports=u),typeof window<"u"&&(window.loadAudio=u)})(R)),R.exports}var F={exports:{}},k,Z;function we(){if(Z)return k;Z=1,k=i;function i(n){var o=n.createGain(),s=o._voltage=a(n),l=e(s),c=e(s),p=e(s);return o._startAmount=e(c),o._endAmount=e(p),o._multiplier=e(l),o._multiplier.connect(o),o._startAmount.connect(o),o._endAmount.connect(o),o.value=l.gain,o.startValue=c.gain,o.endValue=p.gain,o.startValue.value=0,o.endValue.value=0,Object.defineProperties(o,t),o}var t={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(n){var o=this._multiplier.gain,s=this._startAmount.gain,l=this._endAmount.gain;this._voltage.start(n),this._decayFrom=this._decayFrom=n+this.attack,this._startedAt=n;var c=this.sustain;o.cancelScheduledValues(n),s.cancelScheduledValues(n),l.cancelScheduledValues(n),l.setValueAtTime(0,n),this.attack?(o.setValueAtTime(0,n),o.linearRampToValueAtTime(1,n+this.attack),s.setValueAtTime(1,n),s.linearRampToValueAtTime(0,n+this.attack)):(o.setValueAtTime(1,n),s.setValueAtTime(0,n)),this.decay&&o.setTargetAtTime(c,this._decayFrom,u(this.decay))}},stop:{value:function(n,o){o&&(n=n-this.release);var s=n+this.release;if(this.release){var l=this._multiplier.gain,c=this._startAmount.gain,p=this._endAmount.gain;l.cancelScheduledValues(n),c.cancelScheduledValues(n),p.cancelScheduledValues(n);var g=u(this.release);if(this.attack&&n<this._decayFrom){var A=d(0,1,this._startedAt,this._decayFrom,n);l.linearRampToValueAtTime(A,n),c.linearRampToValueAtTime(1-A,n),c.setTargetAtTime(0,n,g)}p.setTargetAtTime(1,n,g),l.setTargetAtTime(0,n,g)}return this._voltage.stop(s),s}},onended:{get:function(){return this._voltage.onended},set:function(n){this._voltage.onended=n}}},r=new Float32Array([1,1]);function a(n){var o=n.createBufferSource(),s=n.createBuffer(1,2,n.sampleRate);return s.getChannelData(0).set(r),o.buffer=s,o.loop=!0,o}function e(n){var o=n.context.createGain();return n.connect(o),o}function u(n){return Math.log(n+1)/Math.log(100)}function d(n,o,s,l,c){var p=o-n,g=l-s,A=c-s,b=A/g,v=n+b*p;return v<=n&&(v=n),v>=o&&(v=o),v}return k}var j,Q;function Ae(){if(Q)return j;Q=1;var i=we(),t={},r={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function a(o,s,l){var c=!1,p=0,g={},A=o.createGain();A.gain.value=1;var b=Object.assign({},r,l),v={context:o,out:A,opts:b};return s instanceof AudioBuffer?v.buffer=s:v.buffers=s,v.start=function(E,m,T){if(v.buffer&&E!==null)return v.start(null,E,m);var y=E?v.buffers[E]:v.buffer;if(y){if(!c){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+E+" not found.");return}var h=T||t;m=Math.max(o.currentTime,m||0),v.emit("start",m,E,h);var f=q(E,y,h);return f.id=C(E,f),f.env.start(m),f.source.start(m),v.emit("started",m,f.id,f),h.duration&&f.stop(m+h.duration),f},v.play=function(E,m,T){return v.start(E,m,T)},v.stop=function(E,m){var T;return m=m||Object.keys(g),m.map(function(y){return T=g[y],T?(T.stop(E),T.id):null})},v.connect=function(E){return c=!0,A.connect(E),v},v.emit=function(E,m,T,y){v.onevent&&v.onevent(E,m,T,y);var h=v["on"+E];h&&h(m,T,y)},v;function C(E,m){return m.id=p++,g[m.id]=m,m.source.onended=function(){var T=o.currentTime;m.source.disconnect(),m.env.disconnect(),m.disconnect(),v.emit("ended",T,m.id,m)},m.id}function q(E,m,T){var y=o.createGain();return y.gain.value=0,y.connect(A),y.env=d(o,T,b),y.env.connect(y.gain),y.source=o.createBufferSource(),y.source.buffer=m,y.source.connect(y),y.source.loop=T.loop||b.loop,y.source.playbackRate.value=n(T.cents||b.cents),y.source.loopStart=T.loopStart||b.loopStart,y.source.loopEnd=T.loopEnd||b.loopEnd,y.stop=function(h){var f=h||o.currentTime;v.emit("stop",f,E);var w=y.env.stop(f);y.source.stop(w)},y}}function e(o){return typeof o=="number"}var u=["attack","decay","sustain","release"];function d(o,s,l){var c=i(o),p=s.adsr||l.adsr;return u.forEach(function(g,A){p?c[g]=p[A]:c[g]=s[g]||l[g]}),c.value.value=e(s.gain)?s.gain:e(l.gain)?l.gain:1,c}function n(o){return o?Math.pow(2,o/1200):1}return j=a,j}var D,W;function Ee(){if(W)return D;W=1,D=function(t){return t.on=function(r,a){if(arguments.length===1&&typeof r=="function")return t.on("event",r);var e="on"+r,u=t[e];return t[e]=u?i(u,a):a,t},t};function i(t,r){return function(a,e,u,d){t(a,e,u,d),r(a,e,u,d)}}return D}var V,ee;function Te(){if(ee)return V;ee=1;var i=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function t(){return i}var r=[0,2,4,5,7,9,11];function a(n,o,s){if(typeof n!="string")return null;var l=i.exec(n);if(!l||!o&&l[4])return null;var c={letter:l[1].toUpperCase(),acc:l[2].replace(/x/g,"##")};return c.pc=c.letter+c.acc,c.step=(c.letter.charCodeAt(0)+3)%7,c.alt=c.acc[0]==="b"?-c.acc.length:c.acc.length,c.chroma=r[c.step]+c.alt,l[3]&&(c.oct=+l[3],c.midi=c.chroma+12*(c.oct+1),c.freq=e(c.midi,s)),o&&(c.tonicOf=l[4]),c}function e(n,o){return Math.pow(2,(n-69)/12)*(o||440)}var u={parse:a,regex:t,midiToFreq:e},d=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];return d.forEach(function(n){u[n]=function(o){var s=a(o);return s&&typeof s[n]<"u"?s[n]:null}}),V=u,V}var $,te;function Se(){if(te)return $;te=1;var i=Te(),t=function(e){return e!==null&&e!==[]&&e>=0&&e<129},r=function(e){return t(e)?+e:i.midi(e)};$=function(e){if(e.buffers){var u=e.opts.map,d=typeof u=="function"?u:r,n=function(s){return s?d(s)||s:null};e.buffers=a(e.buffers,n);var o=e.start;e.start=function(s,l,c){var p=n(s),g=p%1;return g&&(p=Math.floor(p),c=Object.assign(c||{},{cents:Math.floor(g*100)})),o(p,l,c)}}return e};function a(e,u){return Object.keys(e).reduce(function(d,n){return d[u(n)]=e[n],d},{})}return $}var I,re;function Pe(){if(re)return I;re=1;var i=Array.isArray,t=function(a){return a&&typeof a=="object"},r={};return I=function(a){return a.schedule=function(e,u){var d=a.context.currentTime,n=e<d?d:e;a.emit("schedule",n,u);var o,s,l,c;return u.map(function(p){if(p)i(p)?(o=p[0],s=p[1]):(o=p.time,s=p);else return null;return t(s)?(l=s.name||s.key||s.note||s.midi||null,c=s):(l=s,c=r),a.start(l,n+(o||0),c)})},a},I}function M(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var G={exports:{}},ne;function _e(){return ne||(ne=1,(function(i,t){(function(r){i.exports=r()})(function(){return(function r(a,e,u){function d(s,l){if(!e[s]){if(!a[s]){var c=typeof M=="function"&&M;if(!l&&c)return c(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var g=e[s]={exports:{}};a[s][0].call(g.exports,function(A){var b=a[s][1][A];return d(b||A)},g,g.exports,r,a,e,u)}return e[s].exports}for(var n=typeof M=="function"&&M,o=0;o<u.length;o++)d(u[o]);return d})({1:[function(r,a,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(u){function d(n){if(this._event=n,this._data=n.data,this.receivedTime=n.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=n.data[0]&240,this.channel=n.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=n.data[1]&127,this.velocity=n.data[2]&127;break;case 144:this.messageType="noteon",this.key=n.data[1]&127,this.velocity=n.data[2]&127;break;case 160:this.messageType="keypressure",this.key=n.data[1]&127,this.pressure=n.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=n.data[1]&127,this.controllerValue=n.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=n.data[1];break;case 208:this.messageType="channelpressure",this.pressure=n.data[1]&127;break;case 224:this.messageType="pitchbendchange";var o=n.data[2]&127,s=n.data[1]&127;this.pitchBend=(o<<8)+s;break}}return new d(u)},a.exports=e.default},{}]},{},[1])(1)})})(G)),G.exports}var U,oe;function xe(){if(oe)return U;oe=1;var i=_e();return U=function(t){return t.listenToMidi=function(r,a){var e={},u=a||{},d=u.gain||function(n){return n/127};return r.onmidimessage=function(n){var o=n.messageType?n:i(n);if(o.messageType==="noteon"&&o.velocity===0&&(o.messageType="noteoff"),!(u.channel&&o.channel!==u.channel))switch(o.messageType){case"noteon":e[o.key]=t.play(o.key,0,{gain:d(o.velocity)});break;case"noteoff":e[o.key]&&(e[o.key].stop(),delete e[o.key]);break}},t},t},U}var ie;function Ne(){return ie||(ie=1,(function(i){var t=Ae(),r=Ee(),a=Se(),e=Pe(),u=xe();function d(n,o,s){return u(e(a(r(t(n,o,s)))))}i.exports&&(i.exports=d),typeof window<"u"&&(window.SamplePlayer=d)})(F)),F.exports}function ae(i,t){return Array(t+1).join(i)}function z(i){return typeof i=="number"}function Me(i){return typeof i=="string"}function Ce(i){return typeof i<"u"}function le(i,t){return Math.pow(2,(i-69)/12)*(t||440)}var de=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function qe(){return de}var Le=[0,2,4,5,7,9,11];function P(i,t,r){if(typeof i!="string")return null;var a=de.exec(i);if(!a||!t&&a[4])return null;var e={letter:a[1].toUpperCase(),acc:a[2].replace(/x/g,"##")};e.pc=e.letter+e.acc,e.step=(e.letter.charCodeAt(0)+3)%7,e.alt=e.acc[0]==="b"?-e.acc.length:e.acc.length;var u=Le[e.step]+e.alt;return e.chroma=u<0?12+u:u%12,a[3]&&(e.oct=+a[3],e.midi=u+12*(e.oct+1),e.freq=le(e.midi,r)),t&&(e.tonicOf=a[4]),e}var Re="CDEFGAB";function Be(i){return z(i)?i<0?ae("b",-i):ae("#",i):""}function Oe(i){return z(i)?""+i:""}function fe(i,t,r){return i===null||typeof i>"u"?null:i.step?fe(i.step,i.alt,i.oct):i<0||i>6?null:Re.charAt(i)+Be(t)+Oe(r)}function he(i){if((z(i)||Me(i))&&i>=0&&i<128)return+i;var t=P(i);return t&&Ce(t.midi)?t.midi:null}function Fe(i,t){var r=he(i);return r===null?null:le(r,t)}function ke(i){return(P(i)||{}).letter}function je(i){return(P(i)||{}).acc}function De(i){return(P(i)||{}).pc}function Ve(i){return(P(i)||{}).step}function $e(i){return(P(i)||{}).alt}function Ie(i){return(P(i)||{}).chroma}function Ge(i){return(P(i)||{}).oct}const Ue=Object.freeze(Object.defineProperty({__proto__:null,acc:je,alt:$e,build:fe,chroma:Ie,freq:Fe,letter:ke,midi:he,oct:Ge,parse:P,pc:De,regex:qe,step:Ve},Symbol.toStringTag,{value:"Module"})),Je=me(Ue);var J,se;function ze(){if(se)return J;se=1;var i=Je;function t(e,u){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof t))return new t(e);this.nameToUrl=u||t.nameToUrl,this.ctx=e,this.instruments={},this.promises=[]}t.prototype.onready=function(e){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(e)},t.prototype.instrument=function(e,u){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var d=this.ctx;if(e=e||"default",e in this.instruments)return this.instruments[e];var n={name:e,play:a(d,u)};if(this.instruments[e]=n,e!=="default"){var o=t.instrument(d,e,u).then(function(s){return n.play=s.play,n});this.promises.push(o),n.onready=function(s){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),o.then(s)}}else n.onready=function(s){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),s()};return n};function r(e,u,d){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),t.instrument(e,u,d).then(function(n){return n.buffers})}t.loadBuffers=r;function a(e,u){return u=u||{},function(d,n,o,s){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var l=d>0&&d<129?+d:i.midi(d),c=l?i.midiToFreq(l,440):null;if(c){o=o||.2,s=s||{};var p=s.destination||u.destination||e.destination,g=s.vcoType||u.vcoType||"sine",A=s.gain||u.gain||.4,b=e.createOscillator();b.type=g,b.frequency.value=c;var v=e.createGain();return v.gain.value=A,b.connect(v),v.connect(p),b.start(n),o>0&&b.stop(n+o),b}}}return t.noteToMidi=i.midi,J=t,J}var ue;function He(){return ue||(ue=1,(function(i){var t=be(),r=Ne();function a(n,o,s){if(arguments.length===1)return function(A,b){return a(n,A,b)};var l=s||{},c=l.isSoundfontURL||e,p=l.nameToUrl||u,g=c(o)?o:p(o,l.soundfont,l.format);return t(n,g,{only:l.only||l.notes}).then(function(A){var b=r(n,A,l).connect(l.destination?l.destination:n.destination);return b.url=g,b.name=o,b})}function e(n){return/\.js(\?.*)?$/i.test(n)}function u(n,o,s){return s=s==="ogg"?s:"mp3",o=o==="FluidR3_GM"?o:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+o+"/"+n+"-"+s+".js"}var d=ze();d.instrument=a,d.nameToUrl=u,i.exports&&(i.exports=d),typeof window<"u"&&(window.Soundfont=d)})(L)),L.exports}var Xe=He();const ce=ve(Xe);class Ke{instrument=null;activeNotes=new Map;ready=!1;audioContext=null;async initialize(t="electric_piano_1"){try{this.audioContext=new AudioContext,this.instrument=await ce.instrument(this.audioContext,t,{format:"mp3",soundfont:"MusyngKite"}),this.ready=!0,console.log(`Audio service initialized with ${t}`)}catch(r){throw console.error("Failed to initialize audio service:",r),r}}async changeInstrument(t){try{this.stopAllNotes(),this.ready=!1,this.audioContext||(this.audioContext=new AudioContext),this.instrument=await ce.instrument(this.audioContext,t,{format:"mp3",soundfont:"MusyngKite"}),this.ready=!0,console.log(`Changed instrument to ${t}`)}catch(r){throw console.error("Failed to change instrument:",r),r}}playNote(t){if(!this.instrument||!this.ready){console.warn("Audio service not ready");return}if(this.activeNotes.has(t))return;const r=this.instrument.play(t);this.activeNotes.set(t,r)}stopNote(t){const r=this.activeNotes.get(t);r&&(r.stop(),this.activeNotes.delete(t))}stopAllNotes(){this.activeNotes.forEach(t=>t.stop()),this.activeNotes.clear()}isReady(){return this.ready}}const N=new Ke;class Ye{container;activeButtons=new Set;showLabels=!0;currentPreset=null;constructor(t){const r=document.getElementById(t);if(!r)throw new Error(`Container element with id "${t}" not found`);this.container=r}setShowLabels(t){this.showLabels=t,this.currentPreset&&this.render(this.currentPreset)}render(t){this.currentPreset=t,this.activeButtons.clear(),this.container.innerHTML="",this.container.style.display="grid",this.container.style.gridTemplateRows=`repeat(${t.rows}, 1fr)`,this.container.style.gridTemplateColumns=`repeat(${t.cols}, 1fr)`;const r=t.rows>10||t.cols>10?"2px":"6px";this.container.style.gap=r,this.container.style.width="100%",this.container.style.height="100%";const a=t.rows>10||t.cols>10?"8px":"16px";this.container.style.padding=a,t.buttons.forEach(e=>{const u=this.createButton(e);this.container.appendChild(u)})}createButton(t){const r=document.createElement("button");return r.className="pad-button",r.textContent=this.showLabels?t.label||t.note:"",r.dataset.note=t.note,t.color&&(r.style.backgroundColor=t.color),r.style.gridRow=`${t.row+1}`,r.style.gridColumn=`${t.col+1}`,r.addEventListener("mousedown",a=>{a.preventDefault(),this.handleNoteStart(t.note,r)}),r.addEventListener("mouseup",a=>{a.preventDefault(),this.handleNoteEnd(t.note,r)}),r.addEventListener("mouseleave",a=>{a.preventDefault(),this.activeButtons.has(t.note)&&this.handleNoteEnd(t.note,r)}),r.addEventListener("touchstart",a=>{a.preventDefault(),this.handleNoteStart(t.note,r)}),r.addEventListener("touchend",a=>{a.preventDefault(),this.handleNoteEnd(t.note,r)}),r.addEventListener("touchcancel",a=>{a.preventDefault(),this.handleNoteEnd(t.note,r)}),r}handleNoteStart(t,r){if(!N.isReady()){console.warn("Audio service not ready");return}this.activeButtons.has(t)||(this.activeButtons.add(t),r.classList.add("active"),N.playNote(t))}handleNoteEnd(t,r){this.activeButtons.has(t)&&(this.activeButtons.delete(t),r.classList.remove("active"),N.stopNote(t))}stopAll(){this.activeButtons.clear(),N.stopAllNotes(),this.container.querySelectorAll(".pad-button").forEach(r=>r.classList.remove("active"))}}class Ze{container;config;onPresetChange;currentPresetId;constructor(t,r,a){const e=document.getElementById(t);if(!e)throw new Error(`Container element with id "${t}" not found`);this.container=e,this.config=r,this.onPresetChange=a,this.currentPresetId=r.defaultPresetId}render(){this.container.innerHTML="";const t=document.createElement("label");t.textContent="Layout: ",t.htmlFor="preset-select";const r=document.createElement("select");r.id="preset-select",r.className="preset-select",this.config.presets.forEach(a=>{const e=document.createElement("option");e.value=a.id,e.textContent=a.name,e.selected=a.id===this.currentPresetId,r.appendChild(e)}),r.addEventListener("change",a=>{const u=a.target.value;this.selectPreset(u)}),this.container.appendChild(t),this.container.appendChild(r)}selectPreset(t){const r=this.config.presets.find(a=>a.id===t);r?(this.currentPresetId=t,this.onPresetChange(r)):console.error(`Preset with id "${t}" not found`)}getCurrentPreset(){return this.config.presets.find(t=>t.id===this.currentPresetId)}}function Qe(){const i=["C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5"],t=[];for(let r=0;r<i.length;r++){const a=Math.floor(r/6),e=r%6;t.push({row:a,col:e,note:i[r],label:i[r],color:i[r].includes("#")?"#4a5568":"#2d3748"})}return t}function We(){const i=[],r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let a=0;a<16;a++)for(let e=0;e<19;e++){const u=36+e*2+a,d=Math.floor(u/12)-1,n=u%12,o=r[n],s=`${o}${d}`,l=o.includes("#")?"#4a5568":"#2d3748";i.push({row:15-a,col:e,note:s,label:s,color:l})}return i}const et={presets:[{id:"chromatic",name:"Chromatic Scale",rows:4,cols:6,buttons:Qe()},{id:"harpejji",name:"Harpejji",rows:16,cols:19,buttons:We()}],defaultPresetId:"chromatic"};async function tt(){const i=document.getElementById("app");if(!i)throw new Error("App container not found");i.classList.add("loading");const t=document.getElementById("header");if(t){const r=document.createElement("div");r.id="loading-message",r.textContent="Loading audio...",t.appendChild(r)}try{await N.initialize("electric_piano_1");const r=document.getElementById("loading-message");r&&r.remove(),i.classList.remove("loading");const a=new Ye("grid-container"),e=document.getElementById("instrument-selector");if(e){const o=document.createElement("label");o.textContent="Instrument: ",o.htmlFor="instrument-select";const s=document.createElement("select");s.id="instrument-select",s.className="preset-select",[{value:"electric_piano_1",name:"Electric Piano (Rhodes)"},{value:"electric_piano_2",name:"Electric Piano (DX7)"},{value:"acoustic_grand_piano",name:"Acoustic Grand Piano"},{value:"bright_acoustic_piano",name:"Bright Acoustic Piano"},{value:"electric_grand_piano",name:"Electric Grand Piano"},{value:"honky_tonk_piano",name:"Honky-Tonk Piano"},{value:"vibraphone",name:"Vibraphone"},{value:"marimba",name:"Marimba"},{value:"xylophone",name:"Xylophone"},{value:"harpsichord",name:"Harpsichord"},{value:"clavinet",name:"Clavinet"}].forEach(c=>{const p=document.createElement("option");p.value=c.value,p.textContent=c.name,p.selected=c.value==="electric_piano_1",s.appendChild(p)}),s.addEventListener("change",async c=>{const g=c.target.value;s.disabled=!0,a.stopAll();try{await N.changeInstrument(g),s.disabled=!1}catch(A){console.error("Failed to change instrument:",A),s.disabled=!1}}),e.appendChild(o),e.appendChild(s)}const u=document.getElementById("labels-toggle");if(u){const o=document.createElement("input");o.type="checkbox",o.id="show-labels",o.checked=!0;const s=document.createElement("label");s.htmlFor="show-labels",s.textContent="Show note names",o.addEventListener("change",l=>{const c=l.target;a.setShowLabels(c.checked)}),u.appendChild(o),u.appendChild(s)}const d=new Ze("preset-selector",et,o=>{a.stopAll(),a.render(o)});d.render();const n=d.getCurrentPreset();n&&a.render(n),console.log("Music Touchpad initialized successfully!")}catch(r){console.error("Failed to initialize app:",r);const a=document.createElement("div");a.className="error-message",a.textContent="Failed to load audio. Please refresh the page.",i.appendChild(a)}}tt();
