(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const u of e)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(e){const u={};return e.integrity&&(u.integrity=e.integrity),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?u.credentials="include":e.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(e){if(e.ep)return;e.ep=!0;const u=r(e);fetch(e.href,u)}})();function pe(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function me(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var t=a.default;if(typeof t=="function"){var r=function n(){var e=!1;try{e=this instanceof n}catch{}return e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(a).forEach(function(n){var e=Object.getOwnPropertyDescriptor(a,n);Object.defineProperty(r,n,e.get?e:{enumerable:!0,get:function(){return a[n]}})}),r}var L={exports:{}},B={exports:{}},R,H;function ge(){if(H)return R;H=1;function a(r){return r>64&&r<91?r-65:r>96&&r<123?r-71:r>47&&r<58?r+4:r===43?62:r===47?63:0}function t(r,n){for(var e=r.replace(/[^A-Za-z0-9\+\/]/g,""),u=e.length,l=n?Math.ceil((u*3+1>>2)/n)*n:u*3+1>>2,o=new Uint8Array(l),i,s,d=0,c=0,v=0;v<u;v++)if(s=v&3,d|=a(e.charCodeAt(v))<<18-6*s,s===3||u-v===1){for(i=0;i<3&&c<l;i++,c++)o[c]=d>>>(16>>>i&24)&255;d=0}return o}return R={decode:t},R}var F,W;function ye(){return W||(W=1,F=function(a,t){return new Promise(function(r,n){var e=new XMLHttpRequest;t&&(e.responseType=t),e.open("GET",a),e.onload=function(){e.status===200?r(e.response):n(Error(e.statusText))},e.onerror=function(){n(Error("Network Error"))},e.send()})}),F}var K;function be(){return K||(K=1,(function(a){var t=ge(),r=ye();function n(h){return function(f){return typeof f=="string"&&h.test(f)}}function e(h,f){return typeof h=="string"?h+f:typeof h=="function"?h(f):f}function u(h,f,w,T){var N=l(f)?o:i(f)?s:d(f)?c:v(f)?g:A(f)?b:p(f)?C:q(f)?E:m(f)?S:null,_=w||{};return N?N(h,f,_):T?Promise.resolve(T):Promise.reject("Source not valid ("+f+")")}u.fetch=r;function l(h){return h instanceof ArrayBuffer}function o(h,f,w){return new Promise(function(T,N){h.decodeAudioData(f,function(_){T(_)},function(){N("Can't decode audio data ("+f.slice(0,30)+"...)")})})}var i=n(/\.(mp3|wav|ogg)(\?.*)?$/i);function s(h,f,w){var T=e(w.from,f);return u(h,u.fetch(T,"arraybuffer"),w)}function d(h){return h&&typeof h.then=="function"}function c(h,f,w){return f.then(function(T){return u(h,T,w)})}var v=Array.isArray;function g(h,f,w){return Promise.all(f.map(function(T){return u(h,T,w,T)}))}function A(h){return h&&typeof h=="object"}function b(h,f,w){var T={},N=Object.keys(f).map(function(_){if(w.only&&w.only.indexOf(_)===-1)return null;var z=f[_];return u(h,z,w,z).then(function(ve){T[_]=ve})});return Promise.all(N).then(function(){return T})}var p=n(/\.json(\?.*)?$/i);function C(h,f,w){var T=e(w.from,f);return u(h,u.fetch(T,"text").then(JSON.parse),w)}var q=n(/^data:audio/);function E(h,f,w){var T=f.indexOf(",");return u(h,t.decode(f.slice(T+1)).buffer,w)}var m=n(/\.js(\?.*)?$/i);function S(h,f,w){var T=e(w.from,f);return u(h,u.fetch(T,"text").then(y),w)}function y(h){var f=h.indexOf("MIDI.Soundfont.");if(f<0)throw Error("Invalid MIDI.js Soundfont format");f=h.indexOf("=",f)+2;var w=h.lastIndexOf(",");return JSON.parse(h.slice(f,w)+"}")}a.exports&&(a.exports=u),typeof window<"u"&&(window.loadAudio=u)})(B)),B.exports}var O={exports:{}},D,Y;function we(){if(Y)return D;Y=1,D=a;function a(o){var i=o.createGain(),s=i._voltage=n(o),d=e(s),c=e(s),v=e(s);return i._startAmount=e(c),i._endAmount=e(v),i._multiplier=e(d),i._multiplier.connect(i),i._startAmount.connect(i),i._endAmount.connect(i),i.value=d.gain,i.startValue=c.gain,i.endValue=v.gain,i.startValue.value=0,i.endValue.value=0,Object.defineProperties(i,t),i}var t={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(o){var i=this._multiplier.gain,s=this._startAmount.gain,d=this._endAmount.gain;this._voltage.start(o),this._decayFrom=this._decayFrom=o+this.attack,this._startedAt=o;var c=this.sustain;i.cancelScheduledValues(o),s.cancelScheduledValues(o),d.cancelScheduledValues(o),d.setValueAtTime(0,o),this.attack?(i.setValueAtTime(0,o),i.linearRampToValueAtTime(1,o+this.attack),s.setValueAtTime(1,o),s.linearRampToValueAtTime(0,o+this.attack)):(i.setValueAtTime(1,o),s.setValueAtTime(0,o)),this.decay&&i.setTargetAtTime(c,this._decayFrom,u(this.decay))}},stop:{value:function(o,i){i&&(o=o-this.release);var s=o+this.release;if(this.release){var d=this._multiplier.gain,c=this._startAmount.gain,v=this._endAmount.gain;d.cancelScheduledValues(o),c.cancelScheduledValues(o),v.cancelScheduledValues(o);var g=u(this.release);if(this.attack&&o<this._decayFrom){var A=l(0,1,this._startedAt,this._decayFrom,o);d.linearRampToValueAtTime(A,o),c.linearRampToValueAtTime(1-A,o),c.setTargetAtTime(0,o,g)}v.setTargetAtTime(1,o,g),d.setTargetAtTime(0,o,g)}return this._voltage.stop(s),s}},onended:{get:function(){return this._voltage.onended},set:function(o){this._voltage.onended=o}}},r=new Float32Array([1,1]);function n(o){var i=o.createBufferSource(),s=o.createBuffer(1,2,o.sampleRate);return s.getChannelData(0).set(r),i.buffer=s,i.loop=!0,i}function e(o){var i=o.context.createGain();return o.connect(i),i}function u(o){return Math.log(o+1)/Math.log(100)}function l(o,i,s,d,c){var v=i-o,g=d-s,A=c-s,b=A/g,p=o+b*v;return p<=o&&(p=o),p>=i&&(p=i),p}return D}var k,Z;function Ae(){if(Z)return k;Z=1;var a=we(),t={},r={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function n(i,s,d){var c=!1,v=0,g={},A=i.createGain();A.gain.value=1;var b=Object.assign({},r,d),p={context:i,out:A,opts:b};return s instanceof AudioBuffer?p.buffer=s:p.buffers=s,p.start=function(E,m,S){if(p.buffer&&E!==null)return p.start(null,E,m);var y=E?p.buffers[E]:p.buffer;if(y){if(!c){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+E+" not found.");return}var h=S||t;m=Math.max(i.currentTime,m||0),p.emit("start",m,E,h);var f=q(E,y,h);return f.id=C(E,f),f.env.start(m),f.source.start(m),p.emit("started",m,f.id,f),h.duration&&f.stop(m+h.duration),f},p.play=function(E,m,S){return p.start(E,m,S)},p.stop=function(E,m){var S;return m=m||Object.keys(g),m.map(function(y){return S=g[y],S?(S.stop(E),S.id):null})},p.connect=function(E){return c=!0,A.connect(E),p},p.emit=function(E,m,S,y){p.onevent&&p.onevent(E,m,S,y);var h=p["on"+E];h&&h(m,S,y)},p;function C(E,m){return m.id=v++,g[m.id]=m,m.source.onended=function(){var S=i.currentTime;m.source.disconnect(),m.env.disconnect(),m.disconnect(),p.emit("ended",S,m.id,m)},m.id}function q(E,m,S){var y=i.createGain();return y.gain.value=0,y.connect(A),y.env=l(i,S,b),y.env.connect(y.gain),y.source=i.createBufferSource(),y.source.buffer=m,y.source.connect(y),y.source.loop=S.loop||b.loop,y.source.playbackRate.value=o(S.cents||b.cents),y.source.loopStart=S.loopStart||b.loopStart,y.source.loopEnd=S.loopEnd||b.loopEnd,y.stop=function(h){var f=h||i.currentTime;p.emit("stop",f,E);var w=y.env.stop(f);y.source.stop(w)},y}}function e(i){return typeof i=="number"}var u=["attack","decay","sustain","release"];function l(i,s,d){var c=a(i),v=s.adsr||d.adsr;return u.forEach(function(g,A){v?c[g]=v[A]:c[g]=s[g]||d[g]}),c.value.value=e(s.gain)?s.gain:e(d.gain)?d.gain:1,c}function o(i){return i?Math.pow(2,i/1200):1}return k=n,k}var j,Q;function Ee(){if(Q)return j;Q=1,j=function(t){return t.on=function(r,n){if(arguments.length===1&&typeof r=="function")return t.on("event",r);var e="on"+r,u=t[e];return t[e]=u?a(u,n):n,t},t};function a(t,r){return function(n,e,u,l){t(n,e,u,l),r(n,e,u,l)}}return j}var V,ee;function Se(){if(ee)return V;ee=1;var a=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function t(){return a}var r=[0,2,4,5,7,9,11];function n(o,i,s){if(typeof o!="string")return null;var d=a.exec(o);if(!d||!i&&d[4])return null;var c={letter:d[1].toUpperCase(),acc:d[2].replace(/x/g,"##")};return c.pc=c.letter+c.acc,c.step=(c.letter.charCodeAt(0)+3)%7,c.alt=c.acc[0]==="b"?-c.acc.length:c.acc.length,c.chroma=r[c.step]+c.alt,d[3]&&(c.oct=+d[3],c.midi=c.chroma+12*(c.oct+1),c.freq=e(c.midi,s)),i&&(c.tonicOf=d[4]),c}function e(o,i){return Math.pow(2,(o-69)/12)*(i||440)}var u={parse:n,regex:t,midiToFreq:e},l=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];return l.forEach(function(o){u[o]=function(i){var s=n(i);return s&&typeof s[o]<"u"?s[o]:null}}),V=u,V}var $,te;function Te(){if(te)return $;te=1;var a=Se(),t=function(e){return e!==null&&e!==[]&&e>=0&&e<129},r=function(e){return t(e)?+e:a.midi(e)};$=function(e){if(e.buffers){var u=e.opts.map,l=typeof u=="function"?u:r,o=function(s){return s?l(s)||s:null};e.buffers=n(e.buffers,o);var i=e.start;e.start=function(s,d,c){var v=o(s),g=v%1;return g&&(v=Math.floor(v),c=Object.assign(c||{},{cents:Math.floor(g*100)})),i(v,d,c)}}return e};function n(e,u){return Object.keys(e).reduce(function(l,o){return l[u(o)]=e[o],l},{})}return $}var I,re;function Pe(){if(re)return I;re=1;var a=Array.isArray,t=function(n){return n&&typeof n=="object"},r={};return I=function(n){return n.schedule=function(e,u){var l=n.context.currentTime,o=e<l?l:e;n.emit("schedule",o,u);var i,s,d,c;return u.map(function(v){if(v)a(v)?(i=v[0],s=v[1]):(i=v.time,s=v);else return null;return t(s)?(d=s.name||s.key||s.note||s.midi||null,c=s):(d=s,c=r),n.start(d,o+(i||0),c)})},n},I}function M(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var G={exports:{}},ne;function _e(){return ne||(ne=1,(function(a,t){(function(r){a.exports=r()})(function(){return(function r(n,e,u){function l(s,d){if(!e[s]){if(!n[s]){var c=typeof M=="function"&&M;if(!d&&c)return c(s,!0);if(o)return o(s,!0);var v=new Error("Cannot find module '"+s+"'");throw v.code="MODULE_NOT_FOUND",v}var g=e[s]={exports:{}};n[s][0].call(g.exports,function(A){var b=n[s][1][A];return l(b||A)},g,g.exports,r,n,e,u)}return e[s].exports}for(var o=typeof M=="function"&&M,i=0;i<u.length;i++)l(u[i]);return l})({1:[function(r,n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(u){function l(o){if(this._event=o,this._data=o.data,this.receivedTime=o.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=o.data[0]&240,this.channel=o.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=o.data[1]&127,this.velocity=o.data[2]&127;break;case 144:this.messageType="noteon",this.key=o.data[1]&127,this.velocity=o.data[2]&127;break;case 160:this.messageType="keypressure",this.key=o.data[1]&127,this.pressure=o.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=o.data[1]&127,this.controllerValue=o.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=o.data[1];break;case 208:this.messageType="channelpressure",this.pressure=o.data[1]&127;break;case 224:this.messageType="pitchbendchange";var i=o.data[2]&127,s=o.data[1]&127;this.pitchBend=(i<<8)+s;break}}return new l(u)},n.exports=e.default},{}]},{},[1])(1)})})(G)),G.exports}var U,oe;function xe(){if(oe)return U;oe=1;var a=_e();return U=function(t){return t.listenToMidi=function(r,n){var e={},u=n||{},l=u.gain||function(o){return o/127};return r.onmidimessage=function(o){var i=o.messageType?o:a(o);if(i.messageType==="noteon"&&i.velocity===0&&(i.messageType="noteoff"),!(u.channel&&i.channel!==u.channel))switch(i.messageType){case"noteon":e[i.key]=t.play(i.key,0,{gain:l(i.velocity)});break;case"noteoff":e[i.key]&&(e[i.key].stop(),delete e[i.key]);break}},t},t},U}var ie;function Ne(){return ie||(ie=1,(function(a){var t=Ae(),r=Ee(),n=Te(),e=Pe(),u=xe();function l(o,i,s){return u(e(n(r(t(o,i,s)))))}a.exports&&(a.exports=l),typeof window<"u"&&(window.SamplePlayer=l)})(O)),O.exports}function ae(a,t){return Array(t+1).join(a)}function J(a){return typeof a=="number"}function Me(a){return typeof a=="string"}function Ce(a){return typeof a<"u"}function le(a,t){return Math.pow(2,(a-69)/12)*(t||440)}var de=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function qe(){return de}var Le=[0,2,4,5,7,9,11];function P(a,t,r){if(typeof a!="string")return null;var n=de.exec(a);if(!n||!t&&n[4])return null;var e={letter:n[1].toUpperCase(),acc:n[2].replace(/x/g,"##")};e.pc=e.letter+e.acc,e.step=(e.letter.charCodeAt(0)+3)%7,e.alt=e.acc[0]==="b"?-e.acc.length:e.acc.length;var u=Le[e.step]+e.alt;return e.chroma=u<0?12+u:u%12,n[3]&&(e.oct=+n[3],e.midi=u+12*(e.oct+1),e.freq=le(e.midi,r)),t&&(e.tonicOf=n[4]),e}var Be="CDEFGAB";function Re(a){return J(a)?a<0?ae("b",-a):ae("#",a):""}function Fe(a){return J(a)?""+a:""}function fe(a,t,r){return a===null||typeof a>"u"?null:a.step?fe(a.step,a.alt,a.oct):a<0||a>6?null:Be.charAt(a)+Re(t)+Fe(r)}function he(a){if((J(a)||Me(a))&&a>=0&&a<128)return+a;var t=P(a);return t&&Ce(t.midi)?t.midi:null}function Oe(a,t){var r=he(a);return r===null?null:le(r,t)}function De(a){return(P(a)||{}).letter}function ke(a){return(P(a)||{}).acc}function je(a){return(P(a)||{}).pc}function Ve(a){return(P(a)||{}).step}function $e(a){return(P(a)||{}).alt}function Ie(a){return(P(a)||{}).chroma}function Ge(a){return(P(a)||{}).oct}const Ue=Object.freeze(Object.defineProperty({__proto__:null,acc:ke,alt:$e,build:fe,chroma:Ie,freq:Oe,letter:De,midi:he,oct:Ge,parse:P,pc:je,regex:qe,step:Ve},Symbol.toStringTag,{value:"Module"})),Xe=me(Ue);var X,se;function Je(){if(se)return X;se=1;var a=Xe;function t(e,u){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof t))return new t(e);this.nameToUrl=u||t.nameToUrl,this.ctx=e,this.instruments={},this.promises=[]}t.prototype.onready=function(e){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(e)},t.prototype.instrument=function(e,u){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var l=this.ctx;if(e=e||"default",e in this.instruments)return this.instruments[e];var o={name:e,play:n(l,u)};if(this.instruments[e]=o,e!=="default"){var i=t.instrument(l,e,u).then(function(s){return o.play=s.play,o});this.promises.push(i),o.onready=function(s){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),i.then(s)}}else o.onready=function(s){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),s()};return o};function r(e,u,l){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),t.instrument(e,u,l).then(function(o){return o.buffers})}t.loadBuffers=r;function n(e,u){return u=u||{},function(l,o,i,s){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var d=l>0&&l<129?+l:a.midi(l),c=d?a.midiToFreq(d,440):null;if(c){i=i||.2,s=s||{};var v=s.destination||u.destination||e.destination,g=s.vcoType||u.vcoType||"sine",A=s.gain||u.gain||.4,b=e.createOscillator();b.type=g,b.frequency.value=c;var p=e.createGain();return p.gain.value=A,b.connect(p),p.connect(v),b.start(o),i>0&&b.stop(o+i),b}}}return t.noteToMidi=a.midi,X=t,X}var ue;function ze(){return ue||(ue=1,(function(a){var t=be(),r=Ne();function n(o,i,s){if(arguments.length===1)return function(A,b){return n(o,A,b)};var d=s||{},c=d.isSoundfontURL||e,v=d.nameToUrl||u,g=c(i)?i:v(i,d.soundfont,d.format);return t(o,g,{only:d.only||d.notes}).then(function(A){var b=r(o,A,d).connect(d.destination?d.destination:o.destination);return b.url=g,b.name=i,b})}function e(o){return/\.js(\?.*)?$/i.test(o)}function u(o,i,s){return s=s==="ogg"?s:"mp3",i=i==="FluidR3_GM"?i:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+i+"/"+o+"-"+s+".js"}var l=Je();l.instrument=n,l.nameToUrl=u,a.exports&&(a.exports=l),typeof window<"u"&&(window.Soundfont=l)})(L)),L.exports}var He=ze();const ce=pe(He);class We{instrument=null;activeNotes=new Map;ready=!1;audioContext=null;async initialize(t="electric_piano_1"){try{this.audioContext=new AudioContext,this.instrument=await ce.instrument(this.audioContext,t,{format:"mp3",soundfont:"MusyngKite"}),this.ready=!0,console.log(`Audio service initialized with ${t}`)}catch(r){throw console.error("Failed to initialize audio service:",r),r}}async changeInstrument(t){try{this.stopAllNotes(),this.ready=!1,this.audioContext||(this.audioContext=new AudioContext),this.instrument=await ce.instrument(this.audioContext,t,{format:"mp3",soundfont:"MusyngKite"}),this.ready=!0,console.log(`Changed instrument to ${t}`)}catch(r){throw console.error("Failed to change instrument:",r),r}}playNote(t){if(!this.instrument||!this.ready){console.warn("Audio service not ready");return}if(this.activeNotes.has(t))return;const r=this.instrument.play(t);this.activeNotes.set(t,r)}stopNote(t){const r=this.activeNotes.get(t);r&&(r.stop(),this.activeNotes.delete(t))}stopAllNotes(){this.activeNotes.forEach(t=>t.stop()),this.activeNotes.clear()}isReady(){return this.ready}setPitchBend(t,r){const n=this.activeNotes.get(t);if(n)try{n.source&&n.source.detune&&(n.source.detune.value=r)}catch(e){console.warn("Failed to apply pitch bend:",e)}}}const x=new We;class Ke{container;activeButtons=new Set;showLabels=!0;currentPreset=null;dragStartX=new Map;buttonWidth=0;constructor(t){const r=document.getElementById(t);if(!r)throw new Error(`Container element with id "${t}" not found`);this.container=r}setShowLabels(t){this.showLabels=t,this.currentPreset&&this.render(this.currentPreset)}render(t){this.currentPreset=t,this.activeButtons.clear(),this.container.innerHTML="",this.container.style.display="grid",this.container.style.gridTemplateRows=`repeat(${t.rows}, 1fr)`,this.container.style.gridTemplateColumns=`repeat(${t.cols}, 1fr)`;const r=t.rows>10||t.cols>10?"2px":"6px";this.container.style.gap=r,this.container.style.width="100%",this.container.style.height="100%";const n=t.rows>10||t.cols>10?"8px":"16px";this.container.style.padding=n,t.buttons.forEach(e=>{const u=this.createButton(e);this.container.appendChild(u)})}createButton(t){const r=document.createElement("button");return r.className="pad-button",r.textContent=this.showLabels?t.label||t.note:"",r.dataset.note=t.note,t.color&&(r.style.backgroundColor=t.color),r.style.gridRow=`${t.row+1}`,r.style.gridColumn=`${t.col+1}`,r.addEventListener("mousedown",n=>{n.preventDefault(),this.handleNoteStart(t.note,r,n.clientX)}),r.addEventListener("mouseup",n=>{n.preventDefault(),this.handleNoteEnd(t.note,r)}),r.addEventListener("mousemove",n=>{n.preventDefault(),this.activeButtons.has(t.note)&&this.handleDrag(t.note,r,n.clientX)}),r.addEventListener("mouseleave",n=>{n.preventDefault(),this.activeButtons.has(t.note)&&this.handleNoteEnd(t.note,r)}),r.addEventListener("touchstart",n=>{n.preventDefault(),n.touches.length>0&&this.handleNoteStart(t.note,r,n.touches[0].clientX)}),r.addEventListener("touchmove",n=>{n.preventDefault(),this.activeButtons.has(t.note)&&n.touches.length>0&&this.handleDrag(t.note,r,n.touches[0].clientX)}),r.addEventListener("touchend",n=>{n.preventDefault(),this.handleNoteEnd(t.note,r)}),r.addEventListener("touchcancel",n=>{n.preventDefault(),this.handleNoteEnd(t.note,r)}),r}handleNoteStart(t,r,n){if(!x.isReady()){console.warn("Audio service not ready");return}this.activeButtons.has(t)||(this.activeButtons.add(t),r.classList.add("active"),x.playNote(t),this.dragStartX.set(t,n),this.buttonWidth=r.offsetWidth)}handleDrag(t,r,n){const e=this.dragStartX.get(t);if(e===void 0||this.buttonWidth===0)return;const u=n-e,l=200,o=u/this.buttonWidth*l,i=Math.max(-l,Math.min(l,o));x.setPitchBend(t,i)}handleNoteEnd(t,r){this.activeButtons.has(t)&&(this.activeButtons.delete(t),r.classList.remove("active"),x.stopNote(t),this.dragStartX.delete(t))}stopAll(){this.activeButtons.clear(),x.stopAllNotes(),this.container.querySelectorAll(".pad-button").forEach(r=>r.classList.remove("active"))}}class Ye{container;config;onPresetChange;currentPresetId;constructor(t,r,n){const e=document.getElementById(t);if(!e)throw new Error(`Container element with id "${t}" not found`);this.container=e,this.config=r,this.onPresetChange=n,this.currentPresetId=r.defaultPresetId}render(){this.container.innerHTML="";const t=document.createElement("label");t.textContent="Layout: ",t.htmlFor="preset-select";const r=document.createElement("select");r.id="preset-select",r.className="preset-select",this.config.presets.forEach(n=>{const e=document.createElement("option");e.value=n.id,e.textContent=n.name,e.selected=n.id===this.currentPresetId,r.appendChild(e)}),r.addEventListener("change",n=>{const u=n.target.value;this.selectPreset(u)}),this.container.appendChild(t),this.container.appendChild(r)}selectPreset(t){const r=this.config.presets.find(n=>n.id===t);r?(this.currentPresetId=t,this.onPresetChange(r)):console.error(`Preset with id "${t}" not found`)}getCurrentPreset(){return this.config.presets.find(t=>t.id===this.currentPresetId)}}function Ze(){const a=["C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5"],t=[];for(let r=0;r<a.length;r++){const n=Math.floor(r/6),e=r%6;t.push({row:n,col:e,note:a[r],label:a[r],color:a[r].includes("#")?"#4a5568":"#2d3748"})}return t}function Qe(){const a=[],r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let n=0;n<16;n++)for(let e=0;e<19;e++){const u=36+e*2+n,l=Math.floor(u/12)-1,o=u%12,i=r[o],s=`${i}${l}`,d=i.includes("#")?"#4a5568":"#2d3748";a.push({row:15-n,col:e,note:s,label:s,color:d})}return a}const et={presets:[{id:"chromatic",name:"Chromatic Scale",rows:4,cols:6,buttons:Ze()},{id:"harpejji",name:"Harpejji",rows:16,cols:19,buttons:Qe()}],defaultPresetId:"chromatic"};async function tt(){const a=document.getElementById("app");if(!a)throw new Error("App container not found");a.classList.add("loading");const t=document.getElementById("header");if(t){const r=document.createElement("div");r.id="loading-message",r.textContent="Loading audio...",t.appendChild(r)}try{await x.initialize("electric_piano_1");const r=document.getElementById("loading-message");r&&r.remove(),a.classList.remove("loading");const n=new Ke("grid-container"),e=document.getElementById("instrument-selector");if(e){const i=document.createElement("label");i.textContent="Instrument: ",i.htmlFor="instrument-select";const s=document.createElement("select");s.id="instrument-select",s.className="preset-select",[{value:"electric_piano_1",name:"Electric Piano (Rhodes)"},{value:"electric_piano_2",name:"Electric Piano (DX7)"},{value:"acoustic_grand_piano",name:"Acoustic Grand Piano"},{value:"bright_acoustic_piano",name:"Bright Acoustic Piano"},{value:"electric_grand_piano",name:"Electric Grand Piano"},{value:"honky_tonk_piano",name:"Honky-Tonk Piano"},{value:"vibraphone",name:"Vibraphone"},{value:"marimba",name:"Marimba"},{value:"xylophone",name:"Xylophone"},{value:"harpsichord",name:"Harpsichord"},{value:"clavinet",name:"Clavinet"}].forEach(c=>{const v=document.createElement("option");v.value=c.value,v.textContent=c.name,v.selected=c.value==="electric_piano_1",s.appendChild(v)}),s.addEventListener("change",async c=>{const g=c.target.value;s.disabled=!0,n.stopAll();try{await x.changeInstrument(g),s.disabled=!1}catch(A){console.error("Failed to change instrument:",A),s.disabled=!1}}),e.appendChild(i),e.appendChild(s)}const u=document.getElementById("labels-toggle");if(u){const i=document.createElement("input");i.type="checkbox",i.id="show-labels",i.checked=!0;const s=document.createElement("label");s.htmlFor="show-labels",s.textContent="Show note names",i.addEventListener("change",d=>{const c=d.target;n.setShowLabels(c.checked)}),u.appendChild(i),u.appendChild(s)}const l=new Ye("preset-selector",et,i=>{n.stopAll(),n.render(i)});l.render();const o=l.getCurrentPreset();o&&n.render(o),console.log("Music Touchpad initialized successfully!")}catch(r){console.error("Failed to initialize app:",r);const n=document.createElement("div");n.className="error-message",n.textContent="Failed to load audio. Please refresh the page.",a.appendChild(n)}}tt();
